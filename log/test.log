  [1m[35m (1.0ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.5ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_test_isr_calculation
------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_calculate_correctnes
------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (1.7ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA defer_foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA defer_foreign_keys = ON[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixtures Load (7.9ms)[0m  [1m[31mDELETE FROM "attendances";
DELETE FROM "concepts";
DELETE FROM "employees";
DELETE FROM "payrolls";
DELETE FROM "payroll_details";
DELETE FROM "payroll_periods";
DELETE FROM "salaries";
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 14:08:55.892598', '2022-02-16 14:08:55.892598');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 14:08:55.892598', '2022-02-16 14:08:55.892598');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (1, 1, 'Salary', 1, 1, '2022-02-16 14:08:55.894730', '2022-02-16 14:08:55.894730');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (2, 11, 'Social Security', 2, 1, '2022-02-16 14:08:55.894730', '2022-02-16 14:08:55.894730');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (3, 10, 'Tax', 2, 1, '2022-02-16 14:08:55.894730', '2022-02-16 14:08:55.894730');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (1, 1, 'Andres', 'Lopez Barboza', '00214258961', 'LOBA881031HK9', 'Q', 'Developer', 1, '2022-02-16 14:08:55.896059', '2022-02-16 14:08:55.896059');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (2, 1, 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 1, '2022-02-16 14:08:55.896059', '2022-02-16 14:08:55.896059');
INSERT INTO "payrolls" ("id", "tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (1, 9.99, 9.99, 9.99, 0, 1, 1, '2022-02-16 14:08:55.897518', '2022-02-16 14:08:55.897518');
INSERT INTO "payrolls" ("id", "tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (2, 9.99, 9.99, 9.99, 0, 2, 1, '2022-02-16 14:08:55.897518', '2022-02-16 14:08:55.897518');
INSERT INTO "payroll_details" ("id", "quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (980190962, 9.99, 1, 9.99, 9.99, 9.99, 1, 1, '2022-02-16 14:08:55.898825', '2022-02-16 14:08:55.898825');
INSERT INTO "payroll_details" ("id", "quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (298486374, 9.99, 1, 9.99, 9.99, 9.99, 1, 2, '2022-02-16 14:08:55.898825', '2022-02-16 14:08:55.898825');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (1, 2022, 2, 1, '2022-02-01', '2022-02-15', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 14:08:55.900272', '2022-02-16 14:08:55.900272');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (2, 2022, 2, 2, '2022-02-16', '2022-02-28', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 14:08:55.900272', '2022-02-16 14:08:55.900272');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-01-01', 'A', 200.0, 250.0, 1, '2022-02-16 14:08:55.901826', '2022-02-16 14:08:55.901826');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 'A', 9.99, 9.99, 2, '2022-02-16 14:08:55.901826', '2022-02-16 14:08:55.901826')[0m
  [1m[36mTRANSACTION (34.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[35mPRAGMA defer_foreign_keys = 0[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.3ms)[0m  [1m[35mPRAGMA foreign_key_check[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_test_isr_calculation
------------------------------------------------
  [1m[36mEmployee Load (0.3ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_calculate_correctnes
------------------------------------------------
  [1m[36mPayrollPeriod Load (0.3ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.2ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE PayrollPeriod Load (0.0ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE Employee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Create (1.1ms)[0m  [1m[32mINSERT INTO "payrolls" ("tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["tax_amount", 0.0], ["ssn_amount", "[FILTERED]"], ["net_amount", 0.0], ["status", 1], ["employee_id", 1], ["payroll_period_id", 1], ["created_at", "2022-02-16 14:08:56.002851"], ["updated_at", "2022-02-16 14:08:56.002851"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 1) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mSalary Load (0.3ms)[0m  [1m[34mSELECT "salaries".* FROM "salaries" WHERE (employee_id = 1 and date <= '2022-02-15') ORDER BY date desc LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.1ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.2ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 15.0], ["concept_type", 1], ["taxed", 3000.0], ["exempt", 0.0], ["retention", 0.0], ["payroll_id", 980190963], ["concept_id", 1], ["created_at", "2022-02-16 14:08:56.029349"], ["updated_at", "2022-02-16 14:08:56.029349"]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 3000.0], ["updated_at", "2022-02-16 14:08:56.036826"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.2ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 11) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.1ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.0ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.1ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", 42.37], ["payroll_id", 980190963], ["concept_id", 2], ["created_at", "2022-02-16 14:08:56.045531"], ["updated_at", "2022-02-16 14:08:56.045531"]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayrollPeriod Load (0.0ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 2957.63], ["updated_at", "2022-02-16 14:08:56.048579"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "ssn_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["ssn_amount", "[FILTERED]"], ["updated_at", "2022-02-16 14:08:56.051216"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."taxed") FROM "payroll_details" INNER JOIN "payrolls" ON "payrolls"."id" = "payroll_details"."payroll_id" INNER JOIN "payroll_periods" ON "payroll_periods"."id" = "payrolls"."payroll_period_id" WHERE (payroll_periods.year = 2022 and payroll_periods.month = 2 and payrolls.employee_id = 1)[0m
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 10) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.0ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.0ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.2ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", -7.247154947368421], ["payroll_id", 980190963], ["concept_id", 3], ["created_at", "2022-02-16 14:08:56.057419"], ["updated_at", "2022-02-16 14:08:56.057419"]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 2964.87715494737], ["updated_at", "2022-02-16 14:08:56.061992"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "tax_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["tax_amount", -7.24715494736842], ["updated_at", "2022-02-16 14:08:56.064144"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."net_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."tax_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."ssn_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayrollPeriod Update (0.2ms)[0m  [1m[33mUPDATE "payroll_periods" SET "tax_amount" = ?, "ssn_amount" = ?, "net_amount" = ?, "updated_at" = ? WHERE "payroll_periods"."id" = ?[0m  [["tax_amount", 12.73], ["ssn_amount", "[FILTERED]"], ["net_amount", 2984.86], ["updated_at", "2022-02-16 14:08:56.068570"], ["id", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.0ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mTRANSACTION (4.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA defer_foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA defer_foreign_keys = ON[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixtures Load (2.2ms)[0m  [1m[31mDELETE FROM "concepts";
DELETE FROM "employees";
DELETE FROM "salaries";
DELETE FROM "attendances";
DELETE FROM "payroll_periods";
DELETE FROM "payrolls";
DELETE FROM "payroll_details";
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (1, 1, 'Salary', 1, 1, '2022-02-16 14:10:35.221839', '2022-02-16 14:10:35.221839');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (2, 11, 'Social Security', 2, 1, '2022-02-16 14:10:35.221839', '2022-02-16 14:10:35.221839');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (3, 10, 'Tax', 2, 1, '2022-02-16 14:10:35.221839', '2022-02-16 14:10:35.221839');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (1, 1, 'Andres', 'Lopez Barboza', '00214258961', 'LOBA881031HK9', 'Q', 'Developer', 1, '2022-02-16 14:10:35.225005', '2022-02-16 14:10:35.225005');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (2, 1, 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 1, '2022-02-16 14:10:35.225005', '2022-02-16 14:10:35.225005');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-01-01', 'A', 200.0, 250.0, 1, '2022-02-16 14:10:35.228067', '2022-02-16 14:10:35.228067');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 'A', 9.99, 9.99, 2, '2022-02-16 14:10:35.228067', '2022-02-16 14:10:35.228067');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 14:10:35.230766', '2022-02-16 14:10:35.230766');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 14:10:35.230766', '2022-02-16 14:10:35.230766');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (1, 2022, 2, 1, '2022-02-01', '2022-02-15', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 14:10:35.232224', '2022-02-16 14:10:35.232224');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (2, 2022, 2, 2, '2022-02-16', '2022-02-28', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 14:10:35.232224', '2022-02-16 14:10:35.232224');
INSERT INTO "payrolls" ("id", "tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (1, 9.99, 9.99, 9.99, 0, 1, 1, '2022-02-16 14:10:35.233837', '2022-02-16 14:10:35.233837');
INSERT INTO "payrolls" ("id", "tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (2, 9.99, 9.99, 9.99, 0, 2, 1, '2022-02-16 14:10:35.233837', '2022-02-16 14:10:35.233837');
INSERT INTO "payroll_details" ("id", "quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (980190962, 9.99, 1, 9.99, 9.99, 9.99, 1, 1, '2022-02-16 14:10:35.236738', '2022-02-16 14:10:35.236738');
INSERT INTO "payroll_details" ("id", "quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (298486374, 9.99, 1, 9.99, 9.99, 9.99, 1, 2, '2022-02-16 14:10:35.236738', '2022-02-16 14:10:35.236738')[0m
  [1m[36mTRANSACTION (3.2ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA defer_foreign_keys = 0[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.3ms)[0m  [1m[35mPRAGMA foreign_key_check[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_test_isr_calculation
------------------------------------------------
  [1m[36mEmployee Load (0.4ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_calculate_correctnes
------------------------------------------------
  [1m[36mPayrollPeriod Load (0.3ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE PayrollPeriod Load (0.0ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE Employee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Create (1.1ms)[0m  [1m[32mINSERT INTO "payrolls" ("tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["tax_amount", 0.0], ["ssn_amount", "[FILTERED]"], ["net_amount", 0.0], ["status", 1], ["employee_id", 1], ["payroll_period_id", 1], ["created_at", "2022-02-16 14:10:35.297155"], ["updated_at", "2022-02-16 14:10:35.297155"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.5ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 1) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mSalary Load (0.3ms)[0m  [1m[34mSELECT "salaries".* FROM "salaries" WHERE (employee_id = 1 and date <= '2022-02-15') ORDER BY date desc LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.1ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.2ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 15.0], ["concept_type", 1], ["taxed", 3000.0], ["exempt", 0.0], ["retention", 0.0], ["payroll_id", 980190963], ["concept_id", 1], ["created_at", "2022-02-16 14:10:35.322215"], ["updated_at", "2022-02-16 14:10:35.322215"]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 3000.0], ["updated_at", "2022-02-16 14:10:35.342055"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 11) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.0ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.0ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.2ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", 42.37], ["payroll_id", 980190963], ["concept_id", 2], ["created_at", "2022-02-16 14:10:35.348718"], ["updated_at", "2022-02-16 14:10:35.348718"]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 2957.63], ["updated_at", "2022-02-16 14:10:35.354192"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "ssn_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["ssn_amount", "[FILTERED]"], ["updated_at", "2022-02-16 14:10:35.357743"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."taxed") FROM "payroll_details" INNER JOIN "payrolls" ON "payrolls"."id" = "payroll_details"."payroll_id" INNER JOIN "payroll_periods" ON "payroll_periods"."id" = "payrolls"."payroll_period_id" WHERE (payroll_periods.year = 2022 and payroll_periods.month = 2 and payrolls.employee_id = 1)[0m
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 10) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.0ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.0ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.1ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", -7.247154947368421], ["payroll_id", 980190963], ["concept_id", 3], ["created_at", "2022-02-16 14:10:35.363919"], ["updated_at", "2022-02-16 14:10:35.363919"]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.2ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayroll Update (0.2ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 2964.87715494737], ["updated_at", "2022-02-16 14:10:35.368970"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "tax_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["tax_amount", -7.24715494736842], ["updated_at", "2022-02-16 14:10:35.371472"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."net_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."tax_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."ssn_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayrollPeriod Update (0.2ms)[0m  [1m[33mUPDATE "payroll_periods" SET "tax_amount" = ?, "ssn_amount" = ?, "net_amount" = ?, "updated_at" = ? WHERE "payroll_periods"."id" = ?[0m  [["tax_amount", 12.73], ["ssn_amount", "[FILTERED]"], ["net_amount", 2984.86], ["updated_at", "2022-02-16 14:10:35.376463"], ["id", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.0ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (2.2ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA defer_foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA defer_foreign_keys = ON[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixtures Load (3.9ms)[0m  [1m[31mDELETE FROM "concepts";
DELETE FROM "employees";
DELETE FROM "salaries";
DELETE FROM "attendances";
DELETE FROM "payroll_periods";
DELETE FROM "payrolls";
DELETE FROM "payroll_details";
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (1, 1, 'Salary', 1, 1, '2022-02-16 15:11:33.000939', '2022-02-16 15:11:33.000939');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (2, 11, 'Social Security', 2, 1, '2022-02-16 15:11:33.000939', '2022-02-16 15:11:33.000939');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (3, 10, 'Tax', 2, 1, '2022-02-16 15:11:33.000939', '2022-02-16 15:11:33.000939');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (1, 1, 'Andres', 'Lopez Barboza', '00214258961', 'LOBA881031HK9', 'Q', 'Developer', 1, '2022-02-16 15:11:33.004590', '2022-02-16 15:11:33.004590');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (2, 1, 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 1, '2022-02-16 15:11:33.004590', '2022-02-16 15:11:33.004590');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-01-01', 'A', 200.0, 250.0, 1, '2022-02-16 15:11:33.006982', '2022-02-16 15:11:33.006982');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 'A', 9.99, 9.99, 2, '2022-02-16 15:11:33.006982', '2022-02-16 15:11:33.006982');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 15:11:33.009055', '2022-02-16 15:11:33.009055');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 15:11:33.009055', '2022-02-16 15:11:33.009055');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (1, 2022, 2, 1, '2022-02-01', '2022-02-15', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 15:11:33.011036', '2022-02-16 15:11:33.011036');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (2, 2022, 2, 2, '2022-02-16', '2022-02-28', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 15:11:33.011036', '2022-02-16 15:11:33.011036');
INSERT INTO "payrolls" ("id", "tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (1, 9.99, 9.99, 9.99, 0, 1, 1, '2022-02-16 15:11:33.013444', '2022-02-16 15:11:33.013444');
INSERT INTO "payrolls" ("id", "tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (2, 9.99, 9.99, 9.99, 0, 2, 1, '2022-02-16 15:11:33.013444', '2022-02-16 15:11:33.013444');
INSERT INTO "payroll_details" ("id", "quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (980190962, 9.99, 1, 9.99, 9.99, 9.99, 1, 1, '2022-02-16 15:11:33.016363', '2022-02-16 15:11:33.016363');
INSERT INTO "payroll_details" ("id", "quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (298486374, 9.99, 1, 9.99, 9.99, 9.99, 1, 2, '2022-02-16 15:11:33.016363', '2022-02-16 15:11:33.016363')[0m
  [1m[36mTRANSACTION (3.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA defer_foreign_keys = 0[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.3ms)[0m  [1m[35mPRAGMA foreign_key_check[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_test_isr_calculation
------------------------------------------------
  [1m[36mEmployee Load (0.4ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_calculate_correctnes
------------------------------------------------
  [1m[36mPayrollPeriod Load (0.6ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE PayrollPeriod Load (0.0ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE Employee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Create (1.5ms)[0m  [1m[32mINSERT INTO "payrolls" ("tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["tax_amount", 0.0], ["ssn_amount", "[FILTERED]"], ["net_amount", 0.0], ["status", 1], ["employee_id", 1], ["payroll_period_id", 1], ["created_at", "2022-02-16 15:11:33.152441"], ["updated_at", "2022-02-16 15:11:33.152441"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 1) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mSalary Load (0.2ms)[0m  [1m[34mSELECT "salaries".* FROM "salaries" WHERE (employee_id = 1 and date <= '2022-02-15') ORDER BY date desc LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.3ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.3ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.3ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 15.0], ["concept_type", 1], ["taxed", 3000.0], ["exempt", 0.0], ["retention", 0.0], ["payroll_id", 980190963], ["concept_id", 1], ["created_at", "2022-02-16 15:11:33.197488"], ["updated_at", "2022-02-16 15:11:33.197488"]]
  [1m[36mPayrollDetail Sum (0.3ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 3000.0], ["updated_at", "2022-02-16 15:11:33.226278"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 11) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.0ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.0ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.2ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", 42.37], ["payroll_id", 980190963], ["concept_id", 2], ["created_at", "2022-02-16 15:11:33.229985"], ["updated_at", "2022-02-16 15:11:33.229985"]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayroll Update (0.2ms)[0m  [1m[33mUPDATE "payrolls" SET "ssn_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["ssn_amount", "[FILTERED]"], ["updated_at", "2022-02-16 15:11:33.234679"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.2ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 2957.63], ["updated_at", "2022-02-16 15:11:33.238826"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."taxed") FROM "payroll_details" INNER JOIN "payrolls" ON "payrolls"."id" = "payroll_details"."payroll_id" INNER JOIN "payroll_periods" ON "payroll_periods"."id" = "payrolls"."payroll_period_id" WHERE (payroll_periods.year = 2022 and payroll_periods.month = 2 and payrolls.employee_id = 1)[0m
  [1m[36mConcept Load (0.2ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 10) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.1ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.0ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.3ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", -7.247154947368421], ["payroll_id", 980190963], ["concept_id", 3], ["created_at", "2022-02-16 15:11:33.249185"], ["updated_at", "2022-02-16 15:11:33.249185"]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "tax_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["tax_amount", -7.24715494736842], ["updated_at", "2022-02-16 15:11:33.253501"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 2964.87715494737], ["updated_at", "2022-02-16 15:11:33.256437"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."net_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."tax_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."ssn_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayrollPeriod Update (0.2ms)[0m  [1m[33mUPDATE "payroll_periods" SET "tax_amount" = ?, "ssn_amount" = ?, "net_amount" = ?, "updated_at" = ? WHERE "payroll_periods"."id" = ?[0m  [["tax_amount", 12.73], ["ssn_amount", "[FILTERED]"], ["net_amount", 2984.86], ["updated_at", "2022-02-16 15:11:33.260212"], ["id", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.0ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mTRANSACTION (2.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (1.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA defer_foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA defer_foreign_keys = ON[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixtures Load (4.1ms)[0m  [1m[31mDELETE FROM "concepts";
DELETE FROM "employees";
DELETE FROM "salaries";
DELETE FROM "attendances";
DELETE FROM "payroll_periods";
DELETE FROM "payrolls";
DELETE FROM "payroll_details";
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (1, 1, 'Salary', 1, 1, '2022-02-16 15:14:44.452457', '2022-02-16 15:14:44.452457');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (2, 11, 'Social Security', 2, 1, '2022-02-16 15:14:44.452457', '2022-02-16 15:14:44.452457');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (3, 10, 'Tax', 2, 1, '2022-02-16 15:14:44.452457', '2022-02-16 15:14:44.452457');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (1, 1, 'Andres', 'Lopez Barboza', '00214258961', 'LOBA881031HK9', 'Q', 'Developer', 1, '2022-02-16 15:14:44.454427', '2022-02-16 15:14:44.454427');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (2, 1, 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 1, '2022-02-16 15:14:44.454427', '2022-02-16 15:14:44.454427');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-01-01', 'A', 200.0, 250.0, 1, '2022-02-16 15:14:44.456018', '2022-02-16 15:14:44.456018');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 'A', 9.99, 9.99, 2, '2022-02-16 15:14:44.456018', '2022-02-16 15:14:44.456018');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 15:14:44.457457', '2022-02-16 15:14:44.457457');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 15:14:44.457457', '2022-02-16 15:14:44.457457');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (1, 2022, 2, 1, '2022-02-01', '2022-02-15', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 15:14:44.458989', '2022-02-16 15:14:44.458989');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (2, 2022, 2, 2, '2022-02-16', '2022-02-28', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 15:14:44.458989', '2022-02-16 15:14:44.458989');
INSERT INTO "payrolls" ("id", "tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (1, 9.99, 9.99, 9.99, 0, 1, 1, '2022-02-16 15:14:44.460628', '2022-02-16 15:14:44.460628');
INSERT INTO "payrolls" ("id", "tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (2, 9.99, 9.99, 9.99, 0, 2, 1, '2022-02-16 15:14:44.460628', '2022-02-16 15:14:44.460628');
INSERT INTO "payroll_details" ("id", "quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (980190962, 9.99, 1, 9.99, 9.99, 9.99, 1, 1, '2022-02-16 15:14:44.461978', '2022-02-16 15:14:44.461978');
INSERT INTO "payroll_details" ("id", "quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (298486374, 9.99, 1, 9.99, 9.99, 9.99, 1, 2, '2022-02-16 15:14:44.461978', '2022-02-16 15:14:44.461978')[0m
  [1m[36mTRANSACTION (7.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA defer_foreign_keys = 0[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.5ms)[0m  [1m[35mPRAGMA foreign_key_check[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_test_isr_calculation
------------------------------------------------
  [1m[36mEmployee Load (0.3ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_calculate_correctnes
------------------------------------------------
  [1m[36mPayrollPeriod Load (0.3ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE PayrollPeriod Load (0.0ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE Employee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Create (1.7ms)[0m  [1m[32mINSERT INTO "payrolls" ("tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["tax_amount", 0.0], ["ssn_amount", "[FILTERED]"], ["net_amount", 0.0], ["status", 1], ["employee_id", 1], ["payroll_period_id", 1], ["created_at", "2022-02-16 15:14:44.534337"], ["updated_at", "2022-02-16 15:14:44.534337"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.2ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 1) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mSalary Load (0.2ms)[0m  [1m[34mSELECT "salaries".* FROM "salaries" WHERE (employee_id = 1 and date <= '2022-02-15') ORDER BY date desc LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.2ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.3ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 15.0], ["concept_type", 1], ["taxed", 3000.0], ["exempt", 0.0], ["retention", 0.0], ["payroll_id", 980190963], ["concept_id", 1], ["created_at", "2022-02-16 15:14:44.562855"], ["updated_at", "2022-02-16 15:14:44.562855"]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 3000.0], ["updated_at", "2022-02-16 15:14:44.574766"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 11) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.0ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.0ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.1ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", 42.37], ["payroll_id", 980190963], ["concept_id", 2], ["created_at", "2022-02-16 15:14:44.578582"], ["updated_at", "2022-02-16 15:14:44.578582"]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.0ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "ssn_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["ssn_amount", "[FILTERED]"], ["updated_at", "2022-02-16 15:14:44.583147"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 2957.63], ["updated_at", "2022-02-16 15:14:44.584602"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."taxed") FROM "payroll_details" INNER JOIN "payrolls" ON "payrolls"."id" = "payroll_details"."payroll_id" INNER JOIN "payroll_periods" ON "payroll_periods"."id" = "payrolls"."payroll_period_id" WHERE (payroll_periods.year = 2022 and payroll_periods.month = 2 and payrolls.employee_id = 1)[0m
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 10) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.1ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.2ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", -7.247154947368421], ["payroll_id", 980190963], ["concept_id", 3], ["created_at", "2022-02-16 15:14:44.592567"], ["updated_at", "2022-02-16 15:14:44.592567"]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.0ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "tax_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["tax_amount", -7.24715494736842], ["updated_at", "2022-02-16 15:14:44.596387"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 2964.87715494737], ["updated_at", "2022-02-16 15:14:44.599076"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."net_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."tax_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."ssn_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayrollPeriod Update (0.1ms)[0m  [1m[33mUPDATE "payroll_periods" SET "tax_amount" = ?, "ssn_amount" = ?, "net_amount" = ?, "updated_at" = ? WHERE "payroll_periods"."id" = ?[0m  [["tax_amount", 12.73], ["ssn_amount", "[FILTERED]"], ["net_amount", 2984.86], ["updated_at", "2022-02-16 15:14:44.603662"], ["id", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.1ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mPayrollDetail Load (0.2ms)[0m  [1m[34mSELECT "payroll_details".* FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (1.7ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA defer_foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA defer_foreign_keys = ON[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixtures Load (4.6ms)[0m  [1m[31mDELETE FROM "concepts";
DELETE FROM "employees";
DELETE FROM "salaries";
DELETE FROM "attendances";
DELETE FROM "payroll_periods";
DELETE FROM "payrolls";
DELETE FROM "payroll_details";
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (1, 1, 'Salary', 1, 1, '2022-02-16 15:17:02.918760', '2022-02-16 15:17:02.918760');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (2, 11, 'Social Security', 2, 1, '2022-02-16 15:17:02.918760', '2022-02-16 15:17:02.918760');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (3, 10, 'Tax', 2, 1, '2022-02-16 15:17:02.918760', '2022-02-16 15:17:02.918760');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (1, 1, 'Andres', 'Lopez Barboza', '00214258961', 'LOBA881031HK9', 'Q', 'Developer', 1, '2022-02-16 15:17:02.922571', '2022-02-16 15:17:02.922571');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (2, 1, 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 1, '2022-02-16 15:17:02.922571', '2022-02-16 15:17:02.922571');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-01-01', 'A', 200.0, 250.0, 1, '2022-02-16 15:17:02.927847', '2022-02-16 15:17:02.927847');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 'A', 9.99, 9.99, 2, '2022-02-16 15:17:02.927847', '2022-02-16 15:17:02.927847');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 15:17:02.930251', '2022-02-16 15:17:02.930251');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 15:17:02.930251', '2022-02-16 15:17:02.930251');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (1, 2022, 2, 1, '2022-02-01', '2022-02-15', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 15:17:02.932904', '2022-02-16 15:17:02.932904');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (2, 2022, 2, 2, '2022-02-16', '2022-02-28', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 15:17:02.932904', '2022-02-16 15:17:02.932904');
INSERT INTO "payrolls" ("id", "tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (1, 9.99, 9.99, 9.99, 0, 1, 1, '2022-02-16 15:17:02.935655', '2022-02-16 15:17:02.935655');
INSERT INTO "payrolls" ("id", "tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (2, 9.99, 9.99, 9.99, 0, 2, 1, '2022-02-16 15:17:02.935655', '2022-02-16 15:17:02.935655');
INSERT INTO "payroll_details" ("id", "quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (980190962, 9.99, 1, 9.99, 9.99, 9.99, 1, 1, '2022-02-16 15:17:02.938491', '2022-02-16 15:17:02.938491');
INSERT INTO "payroll_details" ("id", "quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (298486374, 9.99, 1, 9.99, 9.99, 9.99, 1, 2, '2022-02-16 15:17:02.938491', '2022-02-16 15:17:02.938491')[0m
  [1m[36mTRANSACTION (3.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA defer_foreign_keys = 0[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.3ms)[0m  [1m[35mPRAGMA foreign_key_check[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_test_isr_calculation
------------------------------------------------
  [1m[36mEmployee Load (0.4ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_calculate_correctnes
------------------------------------------------
  [1m[36mPayrollPeriod Load (0.3ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE PayrollPeriod Load (0.0ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE Employee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Create (1.3ms)[0m  [1m[32mINSERT INTO "payrolls" ("tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["tax_amount", 0.0], ["ssn_amount", "[FILTERED]"], ["net_amount", 0.0], ["status", 1], ["employee_id", 1], ["payroll_period_id", 1], ["created_at", "2022-02-16 15:17:03.048512"], ["updated_at", "2022-02-16 15:17:03.048512"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 1) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mSalary Load (0.3ms)[0m  [1m[34mSELECT "salaries".* FROM "salaries" WHERE (employee_id = 1 and date <= '2022-02-15') ORDER BY date desc LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.2ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.2ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 15.0], ["concept_type", 1], ["taxed", 3000.0], ["exempt", 0.0], ["retention", 0.0], ["payroll_id", 980190963], ["concept_id", 1], ["created_at", "2022-02-16 15:17:03.085181"], ["updated_at", "2022-02-16 15:17:03.085181"]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 3000.0], ["updated_at", "2022-02-16 15:17:03.099385"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 11) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.0ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.0ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.2ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", 42.37], ["payroll_id", 980190963], ["concept_id", 2], ["created_at", "2022-02-16 15:17:03.102980"], ["updated_at", "2022-02-16 15:17:03.102980"]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.0ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "ssn_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["ssn_amount", "[FILTERED]"], ["updated_at", "2022-02-16 15:17:03.107915"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.2ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 2957.63], ["updated_at", "2022-02-16 15:17:03.110107"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."taxed") FROM "payroll_details" INNER JOIN "payrolls" ON "payrolls"."id" = "payroll_details"."payroll_id" INNER JOIN "payroll_periods" ON "payroll_periods"."id" = "payrolls"."payroll_period_id" WHERE (payroll_periods.year = 2022 and payroll_periods.month = 2 and payrolls.employee_id = 1)[0m
  [1m[36mConcept Load (0.2ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 10) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.0ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.0ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.2ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", -7.247154947368421], ["payroll_id", 980190963], ["concept_id", 3], ["created_at", "2022-02-16 15:17:03.117890"], ["updated_at", "2022-02-16 15:17:03.117890"]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "tax_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["tax_amount", -7.24715494736842], ["updated_at", "2022-02-16 15:17:03.121771"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 2964.87715494737], ["updated_at", "2022-02-16 15:17:03.125454"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Sum (0.2ms)[0m  [1m[34mSELECT SUM("payrolls"."net_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."tax_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."ssn_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayrollPeriod Update (0.2ms)[0m  [1m[33mUPDATE "payroll_periods" SET "tax_amount" = ?, "ssn_amount" = ?, "net_amount" = ?, "updated_at" = ? WHERE "payroll_periods"."id" = ?[0m  [["tax_amount", 12.73], ["ssn_amount", "[FILTERED]"], ["net_amount", 2984.86], ["updated_at", "2022-02-16 15:17:03.130418"], ["id", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.0ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mPayrollDetail Load (0.1ms)[0m  [1m[34mSELECT payroll_id,concept_id ,quantity ,concept_type ,taxed ,exempt,retention FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (1.3ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA defer_foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA defer_foreign_keys = ON[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixtures Load (3.0ms)[0m  [1m[31mDELETE FROM "concepts";
DELETE FROM "employees";
DELETE FROM "salaries";
DELETE FROM "attendances";
DELETE FROM "payroll_periods";
DELETE FROM "payrolls";
DELETE FROM "payroll_details";
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (1, 1, 'Salary', 1, 1, '2022-02-16 15:17:27.976959', '2022-02-16 15:17:27.976959');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (2, 11, 'Social Security', 2, 1, '2022-02-16 15:17:27.976959', '2022-02-16 15:17:27.976959');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (3, 10, 'Tax', 2, 1, '2022-02-16 15:17:27.976959', '2022-02-16 15:17:27.976959');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (1, 1, 'Andres', 'Lopez Barboza', '00214258961', 'LOBA881031HK9', 'Q', 'Developer', 1, '2022-02-16 15:17:27.978929', '2022-02-16 15:17:27.978929');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (2, 1, 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 1, '2022-02-16 15:17:27.978929', '2022-02-16 15:17:27.978929');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-01-01', 'A', 200.0, 250.0, 1, '2022-02-16 15:17:27.980547', '2022-02-16 15:17:27.980547');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 'A', 9.99, 9.99, 2, '2022-02-16 15:17:27.980547', '2022-02-16 15:17:27.980547');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 15:17:27.981982', '2022-02-16 15:17:27.981982');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 15:17:27.981982', '2022-02-16 15:17:27.981982');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (1, 2022, 2, 1, '2022-02-01', '2022-02-15', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 15:17:27.983546', '2022-02-16 15:17:27.983546');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (2, 2022, 2, 2, '2022-02-16', '2022-02-28', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 15:17:27.983546', '2022-02-16 15:17:27.983546');
INSERT INTO "payrolls" ("id", "tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (1, 9.99, 9.99, 9.99, 0, 1, 1, '2022-02-16 15:17:27.985193', '2022-02-16 15:17:27.985193');
INSERT INTO "payrolls" ("id", "tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (2, 9.99, 9.99, 9.99, 0, 2, 1, '2022-02-16 15:17:27.985193', '2022-02-16 15:17:27.985193');
INSERT INTO "payroll_details" ("id", "quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (980190962, 9.99, 1, 9.99, 9.99, 9.99, 1, 1, '2022-02-16 15:17:27.987052', '2022-02-16 15:17:27.987052');
INSERT INTO "payroll_details" ("id", "quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (298486374, 9.99, 1, 9.99, 9.99, 9.99, 1, 2, '2022-02-16 15:17:27.987052', '2022-02-16 15:17:27.987052')[0m
  [1m[36mTRANSACTION (3.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[35mPRAGMA defer_foreign_keys = 0[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.5ms)[0m  [1m[35mPRAGMA foreign_key_check[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_test_isr_calculation
------------------------------------------------
  [1m[36mEmployee Load (0.3ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_calculate_correctnes
------------------------------------------------
  [1m[36mPayrollPeriod Load (0.3ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE PayrollPeriod Load (0.0ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE Employee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Create (1.4ms)[0m  [1m[32mINSERT INTO "payrolls" ("tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["tax_amount", 0.0], ["ssn_amount", "[FILTERED]"], ["net_amount", 0.0], ["status", 1], ["employee_id", 1], ["payroll_period_id", 1], ["created_at", "2022-02-16 15:17:28.057271"], ["updated_at", "2022-02-16 15:17:28.057271"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.2ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 1) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mSalary Load (0.3ms)[0m  [1m[34mSELECT "salaries".* FROM "salaries" WHERE (employee_id = 1 and date <= '2022-02-15') ORDER BY date desc LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.1ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.3ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 15.0], ["concept_type", 1], ["taxed", 3000.0], ["exempt", 0.0], ["retention", 0.0], ["payroll_id", 980190963], ["concept_id", 1], ["created_at", "2022-02-16 15:17:28.085261"], ["updated_at", "2022-02-16 15:17:28.085261"]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.2ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 3000.0], ["updated_at", "2022-02-16 15:17:28.098141"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 11) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.0ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.0ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.1ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", 42.37], ["payroll_id", 980190963], ["concept_id", 2], ["created_at", "2022-02-16 15:17:28.101912"], ["updated_at", "2022-02-16 15:17:28.101912"]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "ssn_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["ssn_amount", "[FILTERED]"], ["updated_at", "2022-02-16 15:17:28.106712"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 2957.63], ["updated_at", "2022-02-16 15:17:28.108336"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."taxed") FROM "payroll_details" INNER JOIN "payrolls" ON "payrolls"."id" = "payroll_details"."payroll_id" INNER JOIN "payroll_periods" ON "payroll_periods"."id" = "payrolls"."payroll_period_id" WHERE (payroll_periods.year = 2022 and payroll_periods.month = 2 and payrolls.employee_id = 1)[0m
  [1m[36mConcept Load (0.2ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 10) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.1ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.2ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", -7.247154947368421], ["payroll_id", 980190963], ["concept_id", 3], ["created_at", "2022-02-16 15:17:28.116421"], ["updated_at", "2022-02-16 15:17:28.116421"]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "tax_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["tax_amount", -7.24715494736842], ["updated_at", "2022-02-16 15:17:28.121094"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 2964.87715494737], ["updated_at", "2022-02-16 15:17:28.124643"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."net_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.2ms)[0m  [1m[34mSELECT SUM("payrolls"."tax_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."ssn_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayrollPeriod Update (0.1ms)[0m  [1m[33mUPDATE "payroll_periods" SET "tax_amount" = ?, "ssn_amount" = ?, "net_amount" = ?, "updated_at" = ? WHERE "payroll_periods"."id" = ?[0m  [["tax_amount", 12.73], ["ssn_amount", "[FILTERED]"], ["net_amount", 2984.86], ["updated_at", "2022-02-16 15:17:28.129503"], ["id", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.0ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mPayrollDetail Load (0.2ms)[0m  [1m[34mSELECT "payroll_details".* FROM "payroll_details" WHERE (payroll_id = 980190963) /* loading for inspect */ LIMIT ?[0m  [["LIMIT", 11]]
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mPayrollDetail Load (0.4ms)[0m  [1m[34mSELECT "payroll_details".* FROM "payroll_details" WHERE (payroll_id = 980190963) /* loading for inspect */ LIMIT ?[0m  [["LIMIT", 11]]
  [1m[35m (1.5ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA defer_foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA defer_foreign_keys = ON[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixtures Load (2.7ms)[0m  [1m[31mDELETE FROM "concepts";
DELETE FROM "employees";
DELETE FROM "salaries";
DELETE FROM "attendances";
DELETE FROM "payroll_periods";
DELETE FROM "payrolls";
DELETE FROM "payroll_details";
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (1, 1, 'Salary', 1, 1, '2022-02-16 15:17:42.081245', '2022-02-16 15:17:42.081245');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (2, 11, 'Social Security', 2, 1, '2022-02-16 15:17:42.081245', '2022-02-16 15:17:42.081245');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (3, 10, 'Tax', 2, 1, '2022-02-16 15:17:42.081245', '2022-02-16 15:17:42.081245');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (1, 1, 'Andres', 'Lopez Barboza', '00214258961', 'LOBA881031HK9', 'Q', 'Developer', 1, '2022-02-16 15:17:42.084391', '2022-02-16 15:17:42.084391');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (2, 1, 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 1, '2022-02-16 15:17:42.084391', '2022-02-16 15:17:42.084391');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-01-01', 'A', 200.0, 250.0, 1, '2022-02-16 15:17:42.087783', '2022-02-16 15:17:42.087783');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 'A', 9.99, 9.99, 2, '2022-02-16 15:17:42.087783', '2022-02-16 15:17:42.087783');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 15:17:42.090270', '2022-02-16 15:17:42.090270');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 15:17:42.090270', '2022-02-16 15:17:42.090270');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (1, 2022, 2, 1, '2022-02-01', '2022-02-15', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 15:17:42.092886', '2022-02-16 15:17:42.092886');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (2, 2022, 2, 2, '2022-02-16', '2022-02-28', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 15:17:42.092886', '2022-02-16 15:17:42.092886');
INSERT INTO "payrolls" ("id", "tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (1, 9.99, 9.99, 9.99, 0, 1, 1, '2022-02-16 15:17:42.095383', '2022-02-16 15:17:42.095383');
INSERT INTO "payrolls" ("id", "tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (2, 9.99, 9.99, 9.99, 0, 2, 1, '2022-02-16 15:17:42.095383', '2022-02-16 15:17:42.095383');
INSERT INTO "payroll_details" ("id", "quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (980190962, 9.99, 1, 9.99, 9.99, 9.99, 1, 1, '2022-02-16 15:17:42.097399', '2022-02-16 15:17:42.097399');
INSERT INTO "payroll_details" ("id", "quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (298486374, 9.99, 1, 9.99, 9.99, 9.99, 1, 2, '2022-02-16 15:17:42.097399', '2022-02-16 15:17:42.097399')[0m
  [1m[36mTRANSACTION (4.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA defer_foreign_keys = 0[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.3ms)[0m  [1m[35mPRAGMA foreign_key_check[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_test_isr_calculation
------------------------------------------------
  [1m[36mEmployee Load (0.6ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_calculate_correctnes
------------------------------------------------
  [1m[36mPayrollPeriod Load (0.4ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE PayrollPeriod Load (0.0ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE Employee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Create (2.3ms)[0m  [1m[32mINSERT INTO "payrolls" ("tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["tax_amount", 0.0], ["ssn_amount", "[FILTERED]"], ["net_amount", 0.0], ["status", 1], ["employee_id", 1], ["payroll_period_id", 1], ["created_at", "2022-02-16 15:17:42.169787"], ["updated_at", "2022-02-16 15:17:42.169787"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 1) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mSalary Load (0.4ms)[0m  [1m[34mSELECT "salaries".* FROM "salaries" WHERE (employee_id = 1 and date <= '2022-02-15') ORDER BY date desc LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.1ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.2ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 15.0], ["concept_type", 1], ["taxed", 3000.0], ["exempt", 0.0], ["retention", 0.0], ["payroll_id", 980190963], ["concept_id", 1], ["created_at", "2022-02-16 15:17:42.193994"], ["updated_at", "2022-02-16 15:17:42.193994"]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 3000.0], ["updated_at", "2022-02-16 15:17:42.208396"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 11) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.1ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.0ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.2ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", 42.37], ["payroll_id", 980190963], ["concept_id", 2], ["created_at", "2022-02-16 15:17:42.212771"], ["updated_at", "2022-02-16 15:17:42.212771"]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.0ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "ssn_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["ssn_amount", "[FILTERED]"], ["updated_at", "2022-02-16 15:17:42.217442"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 2957.63], ["updated_at", "2022-02-16 15:17:42.218971"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."taxed") FROM "payroll_details" INNER JOIN "payrolls" ON "payrolls"."id" = "payroll_details"."payroll_id" INNER JOIN "payroll_periods" ON "payroll_periods"."id" = "payrolls"."payroll_period_id" WHERE (payroll_periods.year = 2022 and payroll_periods.month = 2 and payrolls.employee_id = 1)[0m
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 10) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.0ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.0ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.3ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", -7.247154947368421], ["payroll_id", 980190963], ["concept_id", 3], ["created_at", "2022-02-16 15:17:42.225688"], ["updated_at", "2022-02-16 15:17:42.225688"]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "tax_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["tax_amount", -7.24715494736842], ["updated_at", "2022-02-16 15:17:42.230670"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 2964.87715494737], ["updated_at", "2022-02-16 15:17:42.233447"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."net_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."tax_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."ssn_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayrollPeriod Update (0.2ms)[0m  [1m[33mUPDATE "payroll_periods" SET "tax_amount" = ?, "ssn_amount" = ?, "net_amount" = ?, "updated_at" = ? WHERE "payroll_periods"."id" = ?[0m  [["tax_amount", 12.73], ["ssn_amount", "[FILTERED]"], ["net_amount", 2984.86], ["updated_at", "2022-02-16 15:17:42.237320"], ["id", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.0ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mPayrollDetail Pluck (0.1ms)[0m  [1m[34mSELECT payroll_id,concept_id ,quantity ,concept_type ,taxed ,exempt,retention FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (1.5ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA defer_foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA defer_foreign_keys = ON[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixtures Load (2.5ms)[0m  [1m[31mDELETE FROM "concepts";
DELETE FROM "employees";
DELETE FROM "salaries";
DELETE FROM "attendances";
DELETE FROM "payroll_periods";
DELETE FROM "payrolls";
DELETE FROM "payroll_details";
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (1, 1, 'Salary', 1, 1, '2022-02-16 15:18:22.249345', '2022-02-16 15:18:22.249345');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (2, 11, 'Social Security', 2, 1, '2022-02-16 15:18:22.249345', '2022-02-16 15:18:22.249345');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (3, 10, 'Tax', 2, 1, '2022-02-16 15:18:22.249345', '2022-02-16 15:18:22.249345');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (1, 1, 'Andres', 'Lopez Barboza', '00214258961', 'LOBA881031HK9', 'Q', 'Developer', 1, '2022-02-16 15:18:22.252443', '2022-02-16 15:18:22.252443');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (2, 1, 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 1, '2022-02-16 15:18:22.252443', '2022-02-16 15:18:22.252443');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-01-01', 'A', 200.0, 250.0, 1, '2022-02-16 15:18:22.255141', '2022-02-16 15:18:22.255141');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 'A', 9.99, 9.99, 2, '2022-02-16 15:18:22.255141', '2022-02-16 15:18:22.255141');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 15:18:22.258255', '2022-02-16 15:18:22.258255');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 15:18:22.258255', '2022-02-16 15:18:22.258255');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (1, 2022, 2, 1, '2022-02-01', '2022-02-15', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 15:18:22.260992', '2022-02-16 15:18:22.260992');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (2, 2022, 2, 2, '2022-02-16', '2022-02-28', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 15:18:22.260992', '2022-02-16 15:18:22.260992');
INSERT INTO "payrolls" ("id", "tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (1, 9.99, 9.99, 9.99, 0, 1, 1, '2022-02-16 15:18:22.263228', '2022-02-16 15:18:22.263228');
INSERT INTO "payrolls" ("id", "tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (2, 9.99, 9.99, 9.99, 0, 2, 1, '2022-02-16 15:18:22.263228', '2022-02-16 15:18:22.263228');
INSERT INTO "payroll_details" ("id", "quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (980190962, 9.99, 1, 9.99, 9.99, 9.99, 1, 1, '2022-02-16 15:18:22.265867', '2022-02-16 15:18:22.265867');
INSERT INTO "payroll_details" ("id", "quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (298486374, 9.99, 1, 9.99, 9.99, 9.99, 1, 2, '2022-02-16 15:18:22.265867', '2022-02-16 15:18:22.265867')[0m
  [1m[36mTRANSACTION (3.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA defer_foreign_keys = 0[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.3ms)[0m  [1m[35mPRAGMA foreign_key_check[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_test_isr_calculation
------------------------------------------------
  [1m[36mEmployee Load (0.4ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_calculate_correctnes
------------------------------------------------
  [1m[36mPayrollPeriod Load (1.2ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE PayrollPeriod Load (0.0ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE Employee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Create (1.3ms)[0m  [1m[32mINSERT INTO "payrolls" ("tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["tax_amount", 0.0], ["ssn_amount", "[FILTERED]"], ["net_amount", 0.0], ["status", 1], ["employee_id", 1], ["payroll_period_id", 1], ["created_at", "2022-02-16 15:18:22.355781"], ["updated_at", "2022-02-16 15:18:22.355781"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.2ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 1) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mSalary Load (0.3ms)[0m  [1m[34mSELECT "salaries".* FROM "salaries" WHERE (employee_id = 1 and date <= '2022-02-15') ORDER BY date desc LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.2ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.2ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.3ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 15.0], ["concept_type", 1], ["taxed", 3000.0], ["exempt", 0.0], ["retention", 0.0], ["payroll_id", 980190963], ["concept_id", 1], ["created_at", "2022-02-16 15:18:22.389046"], ["updated_at", "2022-02-16 15:18:22.389046"]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 3000.0], ["updated_at", "2022-02-16 15:18:22.404002"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 11) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.0ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.2ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", 42.37], ["payroll_id", 980190963], ["concept_id", 2], ["created_at", "2022-02-16 15:18:22.408122"], ["updated_at", "2022-02-16 15:18:22.408122"]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayroll Update (0.2ms)[0m  [1m[33mUPDATE "payrolls" SET "ssn_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["ssn_amount", "[FILTERED]"], ["updated_at", "2022-02-16 15:18:22.414930"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 2957.63], ["updated_at", "2022-02-16 15:18:22.417591"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayrollDetail Sum (0.3ms)[0m  [1m[34mSELECT SUM("payroll_details"."taxed") FROM "payroll_details" INNER JOIN "payrolls" ON "payrolls"."id" = "payroll_details"."payroll_id" INNER JOIN "payroll_periods" ON "payroll_periods"."id" = "payrolls"."payroll_period_id" WHERE (payroll_periods.year = 2022 and payroll_periods.month = 2 and payrolls.employee_id = 1)[0m
  [1m[36mConcept Load (0.2ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 10) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.0ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.2ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", -7.247154947368421], ["payroll_id", 980190963], ["concept_id", 3], ["created_at", "2022-02-16 15:18:22.426292"], ["updated_at", "2022-02-16 15:18:22.426292"]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "tax_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["tax_amount", -7.24715494736842], ["updated_at", "2022-02-16 15:18:22.431453"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 2964.87715494737], ["updated_at", "2022-02-16 15:18:22.434699"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."net_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."tax_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."ssn_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayrollPeriod Update (0.2ms)[0m  [1m[33mUPDATE "payroll_periods" SET "tax_amount" = ?, "ssn_amount" = ?, "net_amount" = ?, "updated_at" = ? WHERE "payroll_periods"."id" = ?[0m  [["tax_amount", 12.73], ["ssn_amount", "[FILTERED]"], ["net_amount", 2984.86], ["updated_at", "2022-02-16 15:18:22.438394"], ["id", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.0ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mPayrollDetail Pluck (0.1ms)[0m  [1m[34mSELECT "payroll_details".* FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mTRANSACTION (4.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (2.4ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA defer_foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA defer_foreign_keys = ON[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixtures Load (3.6ms)[0m  [1m[31mDELETE FROM "concepts";
DELETE FROM "employees";
DELETE FROM "salaries";
DELETE FROM "attendances";
DELETE FROM "payroll_periods";
DELETE FROM "payrolls";
DELETE FROM "payroll_details";
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (1, 1, 'Salary', 1, 1, '2022-02-16 15:23:32.858235', '2022-02-16 15:23:32.858235');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (2, 11, 'Social Security', 2, 1, '2022-02-16 15:23:32.858235', '2022-02-16 15:23:32.858235');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (3, 10, 'Tax', 2, 1, '2022-02-16 15:23:32.858235', '2022-02-16 15:23:32.858235');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (1, 1, 'Andres', 'Lopez Barboza', '00214258961', 'LOBA881031HK9', 'Q', 'Developer', 1, '2022-02-16 15:23:32.862716', '2022-02-16 15:23:32.862716');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (2, 1, 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 1, '2022-02-16 15:23:32.862716', '2022-02-16 15:23:32.862716');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-01-01', 'A', 200.0, 250.0, 1, '2022-02-16 15:23:32.867140', '2022-02-16 15:23:32.867140');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 'A', 9.99, 9.99, 2, '2022-02-16 15:23:32.867140', '2022-02-16 15:23:32.867140');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 15:23:32.878997', '2022-02-16 15:23:32.878997');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 15:23:32.878997', '2022-02-16 15:23:32.878997');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (1, 2022, 2, 1, '2022-02-01', '2022-02-15', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 15:23:32.882752', '2022-02-16 15:23:32.882752');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (2, 2022, 2, 2, '2022-02-16', '2022-02-28', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 15:23:32.882752', '2022-02-16 15:23:32.882752');
INSERT INTO "payrolls" ("id", "tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (1, 9.99, 9.99, 9.99, 0, 1, 1, '2022-02-16 15:23:32.890601', '2022-02-16 15:23:32.890601');
INSERT INTO "payrolls" ("id", "tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (2, 9.99, 9.99, 9.99, 0, 2, 1, '2022-02-16 15:23:32.890601', '2022-02-16 15:23:32.890601');
INSERT INTO "payroll_details" ("id", "quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (980190962, 9.99, 1, 9.99, 9.99, 9.99, 1, 1, '2022-02-16 15:23:32.893968', '2022-02-16 15:23:32.893968');
INSERT INTO "payroll_details" ("id", "quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (298486374, 9.99, 1, 9.99, 9.99, 9.99, 1, 2, '2022-02-16 15:23:32.893968', '2022-02-16 15:23:32.893968')[0m
  [1m[36mTRANSACTION (5.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA defer_foreign_keys = 0[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.9ms)[0m  [1m[35mPRAGMA foreign_key_check[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_test_isr_calculation
------------------------------------------------
  [1m[36mEmployee Load (0.4ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_calculate_correctnes
------------------------------------------------
  [1m[36mPayrollPeriod Load (0.3ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE PayrollPeriod Load (0.0ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE Employee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Create (1.4ms)[0m  [1m[32mINSERT INTO "payrolls" ("tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["tax_amount", 0.0], ["ssn_amount", "[FILTERED]"], ["net_amount", 0.0], ["status", 1], ["employee_id", 1], ["payroll_period_id", 1], ["created_at", "2022-02-16 15:23:32.969944"], ["updated_at", "2022-02-16 15:23:32.969944"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.2ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 1) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mSalary Load (0.3ms)[0m  [1m[34mSELECT "salaries".* FROM "salaries" WHERE (employee_id = 1 and date <= '2022-02-15') ORDER BY date desc LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.2ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.2ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 15.0], ["concept_type", 1], ["taxed", 3000.0], ["exempt", 0.0], ["retention", 0.0], ["payroll_id", 980190963], ["concept_id", 1], ["created_at", "2022-02-16 15:23:33.006313"], ["updated_at", "2022-02-16 15:23:33.006313"]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollDetail Load (0.2ms)[0m  [1m[34mSELECT "payroll_details".* FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollDetail Load (0.3ms)[0m  [1m[34mSELECT "payroll_details".* FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963)[0m
  [1m[36mCACHE PayrollDetail Sum (0.0ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.2ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 3000.0], ["updated_at", "2022-02-16 15:25:40.666216"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.3ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 11) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.3ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.2ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", 42.37], ["payroll_id", 980190963], ["concept_id", 2], ["created_at", "2022-02-16 15:25:40.677013"], ["updated_at", "2022-02-16 15:25:40.677013"]]
  [1m[36mPayrollDetail Load (0.2ms)[0m  [1m[34mSELECT "payroll_details".* FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayrollDetail Sum (0.7ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollDetail Load (0.2ms)[0m  [1m[34mSELECT "concepts"."code" FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollDetail Load (0.2ms)[0m  [1m[34mSELECT "concepts"."code" FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963)[0m
  [1m[36mConcept Load (0.6ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mCACHE PayrollDetail Sum (0.0ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "ssn_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["ssn_amount", "[FILTERED]"], ["updated_at", "2022-02-16 15:28:28.250825"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 2957.63], ["updated_at", "2022-02-16 15:28:28.252667"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."taxed") FROM "payroll_details" INNER JOIN "payrolls" ON "payrolls"."id" = "payroll_details"."payroll_id" INNER JOIN "payroll_periods" ON "payroll_periods"."id" = "payrolls"."payroll_period_id" WHERE (payroll_periods.year = 2022 and payroll_periods.month = 2 and payrolls.employee_id = 1)[0m
  [1m[36mConcept Load (0.2ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 10) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.1ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.2ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", -7.247154947368421], ["payroll_id", 980190963], ["concept_id", 3], ["created_at", "2022-02-16 15:28:28.335272"], ["updated_at", "2022-02-16 15:28:28.335272"]]
  [1m[36mPayrollDetail Sum (0.7ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.3ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "tax_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["tax_amount", -7.24715494736842], ["updated_at", "2022-02-16 15:28:30.398983"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 2964.87715494737], ["updated_at", "2022-02-16 15:28:30.402295"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."net_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.2ms)[0m  [1m[34mSELECT SUM("payrolls"."tax_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (1.3ms)[0m  [1m[34mSELECT SUM("payrolls"."ssn_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayrollPeriod Update (0.3ms)[0m  [1m[33mUPDATE "payroll_periods" SET "tax_amount" = ?, "ssn_amount" = ?, "net_amount" = ?, "updated_at" = ? WHERE "payroll_periods"."id" = ?[0m  [["tax_amount", 12.73], ["ssn_amount", "[FILTERED]"], ["net_amount", 2984.86], ["updated_at", "2022-02-16 15:28:30.411250"], ["id", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.2ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mPayrollDetail Pluck (0.2ms)[0m  [1m[34mSELECT "payroll_details".* FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mTRANSACTION (2.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (2.8ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA defer_foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA defer_foreign_keys = ON[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixtures Load (7.6ms)[0m  [1m[31mDELETE FROM "concepts";
DELETE FROM "employees";
DELETE FROM "salaries";
DELETE FROM "attendances";
DELETE FROM "payroll_periods";
DELETE FROM "payrolls";
DELETE FROM "payroll_details";
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (1, 1, 'Salary', 1, 1, '2022-02-16 15:30:03.969570', '2022-02-16 15:30:03.969570');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (2, 11, 'Social Security', 2, 1, '2022-02-16 15:30:03.969570', '2022-02-16 15:30:03.969570');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (3, 10, 'Tax', 2, 1, '2022-02-16 15:30:03.969570', '2022-02-16 15:30:03.969570');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (1, 1, 'Andres', 'Lopez Barboza', '00214258961', 'LOBA881031HK9', 'Q', 'Developer', 1, '2022-02-16 15:30:03.971623', '2022-02-16 15:30:03.971623');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (2, 1, 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 1, '2022-02-16 15:30:03.971623', '2022-02-16 15:30:03.971623');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-01-01', 'A', 200.0, 250.0, 1, '2022-02-16 15:30:03.973268', '2022-02-16 15:30:03.973268');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 'A', 9.99, 9.99, 2, '2022-02-16 15:30:03.973268', '2022-02-16 15:30:03.973268');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 15:30:03.974710', '2022-02-16 15:30:03.974710');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 15:30:03.974710', '2022-02-16 15:30:03.974710');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (1, 2022, 2, 1, '2022-02-01', '2022-02-15', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 15:30:03.976297', '2022-02-16 15:30:03.976297');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (2, 2022, 2, 2, '2022-02-16', '2022-02-28', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 15:30:03.976297', '2022-02-16 15:30:03.976297');
INSERT INTO "payrolls" ("id", "tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (1, 9.99, 9.99, 9.99, 0, 1, 1, '2022-02-16 15:30:03.977910', '2022-02-16 15:30:03.977910');
INSERT INTO "payrolls" ("id", "tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (2, 9.99, 9.99, 9.99, 0, 2, 1, '2022-02-16 15:30:03.977910', '2022-02-16 15:30:03.977910');
INSERT INTO "payroll_details" ("id", "quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (980190962, 9.99, 1, 9.99, 9.99, 9.99, 1, 1, '2022-02-16 15:30:03.979340', '2022-02-16 15:30:03.979340');
INSERT INTO "payroll_details" ("id", "quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (298486374, 9.99, 1, 9.99, 9.99, 9.99, 1, 2, '2022-02-16 15:30:03.979340', '2022-02-16 15:30:03.979340')[0m
  [1m[36mTRANSACTION (3.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA defer_foreign_keys = 0[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.4ms)[0m  [1m[35mPRAGMA foreign_key_check[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_calculate_correctnes
------------------------------------------------
  [1m[36mPayrollPeriod Load (0.3ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.2ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE PayrollPeriod Load (0.0ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE Employee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Create (1.1ms)[0m  [1m[32mINSERT INTO "payrolls" ("tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["tax_amount", 0.0], ["ssn_amount", "[FILTERED]"], ["net_amount", 0.0], ["status", 1], ["employee_id", 1], ["payroll_period_id", 1], ["created_at", "2022-02-16 15:30:04.056333"], ["updated_at", "2022-02-16 15:30:04.056333"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.2ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 1) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mSalary Load (0.3ms)[0m  [1m[34mSELECT "salaries".* FROM "salaries" WHERE (employee_id = 1 and date <= '2022-02-15') ORDER BY date desc LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.2ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.4ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.4ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 15.0], ["concept_type", 1], ["taxed", 3000.0], ["exempt", 0.0], ["retention", 0.0], ["payroll_id", 980190963], ["concept_id", 1], ["created_at", "2022-02-16 15:30:53.038865"], ["updated_at", "2022-02-16 15:30:53.038865"]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 3000.0], ["updated_at", "2022-02-16 15:30:55.819753"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 11) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.0ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.0ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.1ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", 42.37], ["payroll_id", 980190963], ["concept_id", 2], ["created_at", "2022-02-16 15:30:55.823490"], ["updated_at", "2022-02-16 15:30:55.823490"]]
  [1m[36mPayrollDetail Sum (0.8ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.3ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayroll Update (0.2ms)[0m  [1m[33mUPDATE "payrolls" SET "ssn_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["ssn_amount", "[FILTERED]"], ["updated_at", "2022-02-16 15:30:57.507272"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 2957.63], ["updated_at", "2022-02-16 15:30:57.509635"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayrollDetail Sum (0.3ms)[0m  [1m[34mSELECT SUM("payroll_details"."taxed") FROM "payroll_details" INNER JOIN "payrolls" ON "payrolls"."id" = "payroll_details"."payroll_id" INNER JOIN "payroll_periods" ON "payroll_periods"."id" = "payrolls"."payroll_period_id" WHERE (payroll_periods.year = 2022 and payroll_periods.month = 2 and payrolls.employee_id = 1)[0m
  [1m[36mConcept Load (0.2ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 10) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.3ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.2ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", -7.247154947368421], ["payroll_id", 980190963], ["concept_id", 3], ["created_at", "2022-02-16 15:30:57.525906"], ["updated_at", "2022-02-16 15:30:57.525906"]]
  [1m[36mPayrollDetail Sum (0.5ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayroll Update (0.2ms)[0m  [1m[33mUPDATE "payrolls" SET "tax_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["tax_amount", -7.24715494736842], ["updated_at", "2022-02-16 15:31:00.468034"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.3ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.2ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 2964.87715494737], ["updated_at", "2022-02-16 15:31:00.473630"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Sum (0.2ms)[0m  [1m[34mSELECT SUM("payrolls"."net_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.2ms)[0m  [1m[34mSELECT SUM("payrolls"."tax_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.2ms)[0m  [1m[34mSELECT SUM("payrolls"."ssn_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayrollPeriod Update (0.2ms)[0m  [1m[33mUPDATE "payroll_periods" SET "tax_amount" = ?, "ssn_amount" = ?, "net_amount" = ?, "updated_at" = ? WHERE "payroll_periods"."id" = ?[0m  [["tax_amount", 12.73], ["ssn_amount", "[FILTERED]"], ["net_amount", 2984.86], ["updated_at", "2022-02-16 15:31:00.481149"], ["id", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.1ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mPayrollDetail Pluck (0.2ms)[0m  [1m[34mSELECT "payroll_details".* FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_test_isr_calculation
------------------------------------------------
  [1m[36mEmployee Load (0.4ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (1.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA defer_foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA defer_foreign_keys = ON[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixtures Load (7.4ms)[0m  [1m[31mDELETE FROM "concepts";
DELETE FROM "employees";
DELETE FROM "salaries";
DELETE FROM "attendances";
DELETE FROM "payroll_periods";
DELETE FROM "payrolls";
DELETE FROM "payroll_details";
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (1, 1, 'Salary', 1, 1, '2022-02-16 15:31:10.482962', '2022-02-16 15:31:10.482962');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (2, 11, 'Social Security', 2, 1, '2022-02-16 15:31:10.482962', '2022-02-16 15:31:10.482962');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (3, 10, 'Tax', 2, 1, '2022-02-16 15:31:10.482962', '2022-02-16 15:31:10.482962');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (1, 1, 'Andres', 'Lopez Barboza', '00214258961', 'LOBA881031HK9', 'Q', 'Developer', 1, '2022-02-16 15:31:10.485771', '2022-02-16 15:31:10.485771');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (2, 1, 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 1, '2022-02-16 15:31:10.485771', '2022-02-16 15:31:10.485771');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-01-01', 'A', 200.0, 250.0, 1, '2022-02-16 15:31:10.488030', '2022-02-16 15:31:10.488030');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 'A', 9.99, 9.99, 2, '2022-02-16 15:31:10.488030', '2022-02-16 15:31:10.488030');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 15:31:10.489758', '2022-02-16 15:31:10.489758');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 15:31:10.489758', '2022-02-16 15:31:10.489758');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (1, 2022, 2, 1, '2022-02-01', '2022-02-15', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 15:31:10.491359', '2022-02-16 15:31:10.491359');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (2, 2022, 2, 2, '2022-02-16', '2022-02-28', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 15:31:10.491359', '2022-02-16 15:31:10.491359');
INSERT INTO "payrolls" ("id", "tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (1, 9.99, 9.99, 9.99, 0, 1, 1, '2022-02-16 15:31:10.493066', '2022-02-16 15:31:10.493066');
INSERT INTO "payrolls" ("id", "tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (2, 9.99, 9.99, 9.99, 0, 2, 1, '2022-02-16 15:31:10.493066', '2022-02-16 15:31:10.493066');
INSERT INTO "payroll_details" ("id", "quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (980190962, 9.99, 1, 9.99, 9.99, 9.99, 1, 1, '2022-02-16 15:31:10.494540', '2022-02-16 15:31:10.494540');
INSERT INTO "payroll_details" ("id", "quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (298486374, 9.99, 1, 9.99, 9.99, 9.99, 1, 2, '2022-02-16 15:31:10.494540', '2022-02-16 15:31:10.494540')[0m
  [1m[36mTRANSACTION (4.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA defer_foreign_keys = 0[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.4ms)[0m  [1m[35mPRAGMA foreign_key_check[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_test_isr_calculation
------------------------------------------------
  [1m[36mEmployee Load (0.3ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_calculate_correctnes
------------------------------------------------
  [1m[36mPayrollPeriod Load (0.3ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE PayrollPeriod Load (0.0ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE Employee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Create (1.6ms)[0m  [1m[32mINSERT INTO "payrolls" ("tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["tax_amount", 0.0], ["ssn_amount", "[FILTERED]"], ["net_amount", 0.0], ["status", 1], ["employee_id", 1], ["payroll_period_id", 1], ["created_at", "2022-02-16 15:31:10.575314"], ["updated_at", "2022-02-16 15:31:10.575314"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.2ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 1) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mSalary Load (0.3ms)[0m  [1m[34mSELECT "salaries".* FROM "salaries" WHERE (employee_id = 1 and date <= '2022-02-15') ORDER BY date desc LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.3ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.2ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 15.0], ["concept_type", 1], ["taxed", 3000.0], ["exempt", 0.0], ["retention", 0.0], ["payroll_id", 980190963], ["concept_id", 1], ["created_at", "2022-02-16 15:31:26.950561"], ["updated_at", "2022-02-16 15:31:26.950561"]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 3000.0], ["updated_at", "2022-02-16 15:31:39.485745"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 11) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.1ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.0ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.2ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", 42.37], ["payroll_id", 980190963], ["concept_id", 2], ["created_at", "2022-02-16 15:32:02.347492"], ["updated_at", "2022-02-16 15:32:02.347492"]]
  [1m[36mPayrollDetail Sum (0.6ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mCACHE PayrollDetail Sum (0.0ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE PayrollDetail Sum (0.0ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "ssn_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["ssn_amount", "[FILTERED]"], ["updated_at", "2022-02-16 15:33:16.064757"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.2ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 2957.63], ["updated_at", "2022-02-16 15:33:16.066505"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."taxed") FROM "payroll_details" INNER JOIN "payrolls" ON "payrolls"."id" = "payroll_details"."payroll_id" INNER JOIN "payroll_periods" ON "payroll_periods"."id" = "payrolls"."payroll_period_id" WHERE (payroll_periods.year = 2022 and payroll_periods.month = 2 and payrolls.employee_id = 1)[0m
  [1m[36mConcept Load (0.2ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 10) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.1ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.2ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", -7.247154947368421], ["payroll_id", 980190963], ["concept_id", 3], ["created_at", "2022-02-16 15:33:26.539097"], ["updated_at", "2022-02-16 15:33:26.539097"]]
  [1m[36mPayrollDetail Sum (0.3ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollDetail Load (0.2ms)[0m  [1m[34mSELECT "payroll_details".* FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mCACHE PayrollDetail Sum (0.0ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayroll Update (0.2ms)[0m  [1m[33mUPDATE "payrolls" SET "tax_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["tax_amount", -7.24715494736842], ["updated_at", "2022-02-16 15:35:42.337125"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.4ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.2ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 2964.87715494737], ["updated_at", "2022-02-16 15:35:42.342894"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Sum (0.3ms)[0m  [1m[34mSELECT SUM("payrolls"."net_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.2ms)[0m  [1m[34mSELECT SUM("payrolls"."tax_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.3ms)[0m  [1m[34mSELECT SUM("payrolls"."ssn_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayrollPeriod Update (0.2ms)[0m  [1m[33mUPDATE "payroll_periods" SET "tax_amount" = ?, "ssn_amount" = ?, "net_amount" = ?, "updated_at" = ? WHERE "payroll_periods"."id" = ?[0m  [["tax_amount", 12.73], ["ssn_amount", "[FILTERED]"], ["net_amount", 2984.86], ["updated_at", "2022-02-16 15:35:42.351041"], ["id", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.0ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mPayrollDetail Pluck (0.1ms)[0m  [1m[34mSELECT "payroll_details".* FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mTRANSACTION (2.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (1.2ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA defer_foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA defer_foreign_keys = ON[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixtures Load (7.8ms)[0m  [1m[31mDELETE FROM "concepts";
DELETE FROM "employees";
DELETE FROM "salaries";
DELETE FROM "attendances";
DELETE FROM "payroll_periods";
DELETE FROM "payrolls";
DELETE FROM "payroll_details";
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (1, 1, 'Salary', 1, 1, '2022-02-16 15:35:57.303387', '2022-02-16 15:35:57.303387');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (2, 11, 'Social Security', 2, 1, '2022-02-16 15:35:57.303387', '2022-02-16 15:35:57.303387');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (3, 10, 'Tax', 2, 1, '2022-02-16 15:35:57.303387', '2022-02-16 15:35:57.303387');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (1, 1, 'Andres', 'Lopez Barboza', '00214258961', 'LOBA881031HK9', 'Q', 'Developer', 1, '2022-02-16 15:35:57.305490', '2022-02-16 15:35:57.305490');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (2, 1, 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 1, '2022-02-16 15:35:57.305490', '2022-02-16 15:35:57.305490');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-01-01', 'A', 200.0, 250.0, 1, '2022-02-16 15:35:57.307143', '2022-02-16 15:35:57.307143');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 'A', 9.99, 9.99, 2, '2022-02-16 15:35:57.307143', '2022-02-16 15:35:57.307143');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 15:35:57.308597', '2022-02-16 15:35:57.308597');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 15:35:57.308597', '2022-02-16 15:35:57.308597');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (1, 2022, 2, 1, '2022-02-01', '2022-02-15', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 15:35:57.310121', '2022-02-16 15:35:57.310121');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (2, 2022, 2, 2, '2022-02-16', '2022-02-28', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 15:35:57.310121', '2022-02-16 15:35:57.310121');
INSERT INTO "payrolls" ("id", "tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (1, 9.99, 9.99, 9.99, 0, 1, 1, '2022-02-16 15:35:57.311795', '2022-02-16 15:35:57.311795');
INSERT INTO "payrolls" ("id", "tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (2, 9.99, 9.99, 9.99, 0, 2, 1, '2022-02-16 15:35:57.311795', '2022-02-16 15:35:57.311795');
INSERT INTO "payroll_details" ("id", "quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (980190962, 9.99, 1, 9.99, 9.99, 9.99, 1, 1, '2022-02-16 15:35:57.313106', '2022-02-16 15:35:57.313106');
INSERT INTO "payroll_details" ("id", "quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (298486374, 9.99, 1, 9.99, 9.99, 9.99, 1, 2, '2022-02-16 15:35:57.313106', '2022-02-16 15:35:57.313106')[0m
  [1m[36mTRANSACTION (36.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[35mPRAGMA defer_foreign_keys = 0[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.7ms)[0m  [1m[35mPRAGMA foreign_key_check[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_calculate_correctnes
------------------------------------------------
  [1m[36mPayrollPeriod Load (0.6ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.3ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE PayrollPeriod Load (0.0ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE Employee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Create (2.4ms)[0m  [1m[32mINSERT INTO "payrolls" ("tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["tax_amount", 0.0], ["ssn_amount", "[FILTERED]"], ["net_amount", 0.0], ["status", 1], ["employee_id", 1], ["payroll_period_id", 1], ["created_at", "2022-02-16 15:35:57.474124"], ["updated_at", "2022-02-16 15:35:57.474124"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.3ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 1) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mSalary Load (0.5ms)[0m  [1m[34mSELECT "salaries".* FROM "salaries" WHERE (employee_id = 1 and date <= '2022-02-15') ORDER BY date desc LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.3ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.2ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.5ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 15.0], ["concept_type", 1], ["taxed", 3000.0], ["exempt", 0.0], ["retention", 0.0], ["payroll_id", 980190963], ["concept_id", 1], ["created_at", "2022-02-16 15:35:57.522041"], ["updated_at", "2022-02-16 15:35:57.522041"]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.3ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 3000.0], ["updated_at", "2022-02-16 15:36:02.615632"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.2ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 11) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.0ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.5ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.3ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", 42.37], ["payroll_id", 980190963], ["concept_id", 2], ["created_at", "2022-02-16 15:36:02.622147"], ["updated_at", "2022-02-16 15:36:02.622147"]]
  [1m[36mPayrollDetail Sum (0.3ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (1.6ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayroll Update (0.2ms)[0m  [1m[33mUPDATE "payrolls" SET "ssn_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["ssn_amount", "[FILTERED]"], ["updated_at", "2022-02-16 15:36:11.045437"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (1.0ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.2ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 2957.63], ["updated_at", "2022-02-16 15:36:11.049737"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayrollDetail Sum (0.3ms)[0m  [1m[34mSELECT SUM("payroll_details"."taxed") FROM "payroll_details" INNER JOIN "payrolls" ON "payrolls"."id" = "payroll_details"."payroll_id" INNER JOIN "payroll_periods" ON "payroll_periods"."id" = "payrolls"."payroll_period_id" WHERE (payroll_periods.year = 2022 and payroll_periods.month = 2 and payrolls.employee_id = 1)[0m
  [1m[36mConcept Load (0.3ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 10) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.1ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.3ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", -7.247154947368421], ["payroll_id", 980190963], ["concept_id", 3], ["created_at", "2022-02-16 15:39:15.080144"], ["updated_at", "2022-02-16 15:39:15.080144"]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayroll Update (0.4ms)[0m  [1m[33mUPDATE "payrolls" SET "tax_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["tax_amount", -7.24715494736842], ["updated_at", "2022-02-16 15:39:17.627329"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.3ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 2964.87715494737], ["updated_at", "2022-02-16 15:39:17.632496"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Sum (0.2ms)[0m  [1m[34mSELECT SUM("payrolls"."net_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."tax_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.2ms)[0m  [1m[34mSELECT SUM("payrolls"."ssn_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayrollPeriod Update (0.3ms)[0m  [1m[33mUPDATE "payroll_periods" SET "tax_amount" = ?, "ssn_amount" = ?, "net_amount" = ?, "updated_at" = ? WHERE "payroll_periods"."id" = ?[0m  [["tax_amount", 12.73], ["ssn_amount", "[FILTERED]"], ["net_amount", 2984.86], ["updated_at", "2022-02-16 15:39:17.638298"], ["id", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.2ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mPayrollDetail Pluck (0.3ms)[0m  [1m[34mSELECT "payroll_details".* FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_test_isr_calculation
------------------------------------------------
  [1m[36mEmployee Load (0.6ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (1.6ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA defer_foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA defer_foreign_keys = ON[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixtures Load (3.5ms)[0m  [1m[31mDELETE FROM "concepts";
DELETE FROM "employees";
DELETE FROM "salaries";
DELETE FROM "attendances";
DELETE FROM "payroll_periods";
DELETE FROM "payrolls";
DELETE FROM "payroll_details";
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (1, 1, 'Salary', 1, 1, '2022-02-16 15:39:35.435460', '2022-02-16 15:39:35.435460');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (2, 11, 'Social Security', 2, 1, '2022-02-16 15:39:35.435460', '2022-02-16 15:39:35.435460');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (3, 10, 'Tax', 2, 1, '2022-02-16 15:39:35.435460', '2022-02-16 15:39:35.435460');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (1, 1, 'Andres', 'Lopez Barboza', '00214258961', 'LOBA881031HK9', 'Q', 'Developer', 1, '2022-02-16 15:39:35.437447', '2022-02-16 15:39:35.437447');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (2, 1, 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 1, '2022-02-16 15:39:35.437447', '2022-02-16 15:39:35.437447');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-01-01', 'A', 570.5, 592.25, 1, '2022-02-16 15:39:35.439556', '2022-02-16 15:39:35.439556');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 'A', 9.99, 9.99, 2, '2022-02-16 15:39:35.439556', '2022-02-16 15:39:35.439556');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 15:39:35.441089', '2022-02-16 15:39:35.441089');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 15:39:35.441089', '2022-02-16 15:39:35.441089');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (1, 2022, 2, 1, '2022-02-01', '2022-02-15', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 15:39:35.442602', '2022-02-16 15:39:35.442602');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (2, 2022, 2, 2, '2022-02-16', '2022-02-28', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 15:39:35.442602', '2022-02-16 15:39:35.442602');
INSERT INTO "payrolls" ("id", "tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (1, 9.99, 9.99, 9.99, 0, 1, 1, '2022-02-16 15:39:35.444263', '2022-02-16 15:39:35.444263');
INSERT INTO "payrolls" ("id", "tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (2, 9.99, 9.99, 9.99, 0, 2, 1, '2022-02-16 15:39:35.444263', '2022-02-16 15:39:35.444263');
INSERT INTO "payroll_details" ("id", "quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (980190962, 9.99, 1, 9.99, 9.99, 9.99, 1, 1, '2022-02-16 15:39:35.445628', '2022-02-16 15:39:35.445628');
INSERT INTO "payroll_details" ("id", "quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (298486374, 9.99, 1, 9.99, 9.99, 9.99, 1, 2, '2022-02-16 15:39:35.445628', '2022-02-16 15:39:35.445628')[0m
  [1m[36mTRANSACTION (5.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA defer_foreign_keys = 0[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.3ms)[0m  [1m[35mPRAGMA foreign_key_check[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_test_isr_calculation
------------------------------------------------
  [1m[36mEmployee Load (0.3ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_calculate_correctnes
------------------------------------------------
  [1m[36mPayrollPeriod Load (0.3ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE PayrollPeriod Load (0.0ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE Employee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Create (1.9ms)[0m  [1m[32mINSERT INTO "payrolls" ("tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["tax_amount", 0.0], ["ssn_amount", "[FILTERED]"], ["net_amount", 0.0], ["status", 1], ["employee_id", 1], ["payroll_period_id", 1], ["created_at", "2022-02-16 15:39:35.520954"], ["updated_at", "2022-02-16 15:39:35.520954"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.2ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 1) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mSalary Load (0.3ms)[0m  [1m[34mSELECT "salaries".* FROM "salaries" WHERE (employee_id = 1 and date <= '2022-02-15') ORDER BY date desc LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.2ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.3ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 15.0], ["concept_type", 1], ["taxed", 8557.5], ["exempt", 0.0], ["retention", 0.0], ["payroll_id", 980190963], ["concept_id", 1], ["created_at", "2022-02-16 15:39:35.557596"], ["updated_at", "2022-02-16 15:39:35.557596"]]
  [1m[36mPayrollDetail Sum (1.8ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (0.4ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 8557.5], ["updated_at", "2022-02-16 15:39:42.033909"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 11) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.0ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.0ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.4ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", 42.37], ["payroll_id", 980190963], ["concept_id", 2], ["created_at", "2022-02-16 15:39:42.037852"], ["updated_at", "2022-02-16 15:39:42.037852"]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "ssn_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["ssn_amount", "[FILTERED]"], ["updated_at", "2022-02-16 15:39:43.026810"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 8515.13], ["updated_at", "2022-02-16 15:39:43.028598"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."taxed") FROM "payroll_details" INNER JOIN "payrolls" ON "payrolls"."id" = "payroll_details"."payroll_id" INNER JOIN "payroll_periods" ON "payroll_periods"."id" = "payrolls"."payroll_period_id" WHERE (payroll_periods.year = 2022 and payroll_periods.month = 2 and payrolls.employee_id = 1)[0m
  [1m[36mConcept Load (0.2ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 10) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.1ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.2ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", 1121.0490069473685], ["payroll_id", 980190963], ["concept_id", 3], ["created_at", "2022-02-16 15:39:44.060918"], ["updated_at", "2022-02-16 15:39:44.060918"]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "tax_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["tax_amount", 1121.04900694737], ["updated_at", "2022-02-16 15:39:47.063573"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 7394.08099305263], ["updated_at", "2022-02-16 15:39:47.066814"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."net_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."tax_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."ssn_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayrollPeriod Update (0.3ms)[0m  [1m[33mUPDATE "payroll_periods" SET "tax_amount" = ?, "ssn_amount" = ?, "net_amount" = ?, "updated_at" = ? WHERE "payroll_periods"."id" = ?[0m  [["tax_amount", 1141.03], ["ssn_amount", "[FILTERED]"], ["net_amount", 7414.06], ["updated_at", "2022-02-16 15:39:47.070867"], ["id", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.1ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mPayrollDetail Pluck (0.3ms)[0m  [1m[34mSELECT "payroll_details".* FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mTRANSACTION (3.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (1.3ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA defer_foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA defer_foreign_keys = ON[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixtures Load (7.7ms)[0m  [1m[31mDELETE FROM "concepts";
DELETE FROM "employees";
DELETE FROM "salaries";
DELETE FROM "attendances";
DELETE FROM "payroll_periods";
DELETE FROM "payrolls";
DELETE FROM "payroll_details";
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (1, 1, 'Salary', 1, 1, '2022-02-16 15:41:02.773632', '2022-02-16 15:41:02.773632');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (2, 11, 'Social Security', 2, 1, '2022-02-16 15:41:02.773632', '2022-02-16 15:41:02.773632');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (3, 10, 'Tax', 2, 1, '2022-02-16 15:41:02.773632', '2022-02-16 15:41:02.773632');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (1, 1, 'Andres', 'Lopez Barboza', '00214258961', 'LOBA881031HK9', 'Q', 'Developer', 1, '2022-02-16 15:41:02.775600', '2022-02-16 15:41:02.775600');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (2, 1, 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 1, '2022-02-16 15:41:02.775600', '2022-02-16 15:41:02.775600');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-01-01', 'A', 570.5, 592.25, 1, '2022-02-16 15:41:02.777123', '2022-02-16 15:41:02.777123');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 'A', 9.99, 9.99, 2, '2022-02-16 15:41:02.777123', '2022-02-16 15:41:02.777123');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 15:41:02.778557', '2022-02-16 15:41:02.778557');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 15:41:02.778557', '2022-02-16 15:41:02.778557');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (1, 2022, 2, 1, '2022-02-01', '2022-02-15', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 15:41:02.780050', '2022-02-16 15:41:02.780050');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (2, 2022, 2, 2, '2022-02-16', '2022-02-28', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 15:41:02.780050', '2022-02-16 15:41:02.780050');
INSERT INTO "payrolls" ("id", "tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (1, 9.99, 9.99, 9.99, 0, 1, 1, '2022-02-16 15:41:02.781728', '2022-02-16 15:41:02.781728');
INSERT INTO "payrolls" ("id", "tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (2, 9.99, 9.99, 9.99, 0, 2, 1, '2022-02-16 15:41:02.781728', '2022-02-16 15:41:02.781728');
INSERT INTO "payroll_details" ("id", "quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (980190962, 9.99, 1, 9.99, 9.99, 9.99, 1, 1, '2022-02-16 15:41:02.783352', '2022-02-16 15:41:02.783352');
INSERT INTO "payroll_details" ("id", "quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (298486374, 9.99, 1, 9.99, 9.99, 9.99, 1, 2, '2022-02-16 15:41:02.783352', '2022-02-16 15:41:02.783352')[0m
  [1m[36mTRANSACTION (4.2ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA defer_foreign_keys = 0[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.4ms)[0m  [1m[35mPRAGMA foreign_key_check[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_calculate_correctnes
------------------------------------------------
  [1m[36mPayrollPeriod Load (0.3ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.2ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE PayrollPeriod Load (0.0ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE Employee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Create (1.2ms)[0m  [1m[32mINSERT INTO "payrolls" ("tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["tax_amount", 0.0], ["ssn_amount", "[FILTERED]"], ["net_amount", 0.0], ["status", 1], ["employee_id", 1], ["payroll_period_id", 1], ["created_at", "2022-02-16 15:41:02.844113"], ["updated_at", "2022-02-16 15:41:02.844113"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.2ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 1) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mSalary Load (0.3ms)[0m  [1m[34mSELECT "salaries".* FROM "salaries" WHERE (employee_id = 1 and date <= '2022-02-15') ORDER BY date desc LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.1ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.2ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 15.0], ["concept_type", 1], ["taxed", 8557.5], ["exempt", 0.0], ["retention", 0.0], ["payroll_id", 980190963], ["concept_id", 1], ["created_at", "2022-02-16 15:41:02.870149"], ["updated_at", "2022-02-16 15:41:02.870149"]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.2ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 8557.5], ["updated_at", "2022-02-16 15:41:10.031212"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.3ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 11) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.1ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.0ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.2ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", 42.37], ["payroll_id", 980190963], ["concept_id", 2], ["created_at", "2022-02-16 15:41:10.038098"], ["updated_at", "2022-02-16 15:41:10.038098"]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (0.5ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayroll Update (0.2ms)[0m  [1m[33mUPDATE "payrolls" SET "ssn_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["ssn_amount", "[FILTERED]"], ["updated_at", "2022-02-16 15:41:11.037197"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.2ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 8515.13], ["updated_at", "2022-02-16 15:41:11.040756"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."taxed") FROM "payroll_details" INNER JOIN "payrolls" ON "payrolls"."id" = "payroll_details"."payroll_id" INNER JOIN "payroll_periods" ON "payroll_periods"."id" = "payrolls"."payroll_period_id" WHERE (payroll_periods.year = 2022 and payroll_periods.month = 2 and payrolls.employee_id = 1)[0m
  [1m[36mConcept Load (0.2ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 10) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.1ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.0ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.2ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", 1121.0490069473685], ["payroll_id", 980190963], ["concept_id", 3], ["created_at", "2022-02-16 15:41:13.091130"], ["updated_at", "2022-02-16 15:41:13.091130"]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "tax_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["tax_amount", 1121.04900694737], ["updated_at", "2022-02-16 15:41:14.473604"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.2ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 7394.08099305263], ["updated_at", "2022-02-16 15:41:14.476655"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Sum (0.2ms)[0m  [1m[34mSELECT SUM("payrolls"."net_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.2ms)[0m  [1m[34mSELECT SUM("payrolls"."tax_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.3ms)[0m  [1m[34mSELECT SUM("payrolls"."ssn_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayrollPeriod Update (0.2ms)[0m  [1m[33mUPDATE "payroll_periods" SET "tax_amount" = ?, "ssn_amount" = ?, "net_amount" = ?, "updated_at" = ? WHERE "payroll_periods"."id" = ?[0m  [["tax_amount", 1141.03], ["ssn_amount", "[FILTERED]"], ["net_amount", 7414.06], ["updated_at", "2022-02-16 15:41:14.485658"], ["id", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.2ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mPayrollDetail Load (0.2ms)[0m  [1m[34mSELECT "payroll_details".* FROM "payroll_details" WHERE (payroll_id = 980190963) ORDER BY "payroll_details"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mPayrollDetail Load (0.2ms)[0m  [1m[34mSELECT "payroll_details".* FROM "payroll_details" WHERE (payroll_id = 980190963) ORDER BY "payroll_details"."id" ASC LIMIT ? OFFSET ?[0m  [["LIMIT", 1], ["OFFSET", 1]]
  [1m[36mPayrollDetail Load (0.2ms)[0m  [1m[34mSELECT "payroll_details".* FROM "payroll_details" WHERE (payroll_id = 980190963) ORDER BY "payroll_details"."id" ASC LIMIT ? OFFSET ?[0m  [["LIMIT", 1], ["OFFSET", 2]]
  [1m[36mTRANSACTION (2.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_test_isr_calculation
------------------------------------------------
  [1m[36mEmployee Load (1.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (1.3ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA defer_foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA defer_foreign_keys = ON[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixtures Load (8.5ms)[0m  [1m[31mDELETE FROM "concepts";
DELETE FROM "employees";
DELETE FROM "salaries";
DELETE FROM "attendances";
DELETE FROM "payroll_periods";
DELETE FROM "payrolls";
DELETE FROM "payroll_details";
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (1, 1, 'Salary', 1, 1, '2022-02-16 15:42:20.932850', '2022-02-16 15:42:20.932850');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (2, 11, 'Social Security', 2, 1, '2022-02-16 15:42:20.932850', '2022-02-16 15:42:20.932850');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (3, 10, 'Tax', 2, 1, '2022-02-16 15:42:20.932850', '2022-02-16 15:42:20.932850');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (1, 1, 'Andres', 'Lopez Barboza', '00214258961', 'LOBA881031HK9', 'Q', 'Developer', 1, '2022-02-16 15:42:20.934875', '2022-02-16 15:42:20.934875');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (2, 1, 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 1, '2022-02-16 15:42:20.934875', '2022-02-16 15:42:20.934875');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-01-01', 'A', 570.5, 592.25, 1, '2022-02-16 15:42:20.936506', '2022-02-16 15:42:20.936506');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 'A', 9.99, 9.99, 2, '2022-02-16 15:42:20.936506', '2022-02-16 15:42:20.936506');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 15:42:20.937930', '2022-02-16 15:42:20.937930');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 15:42:20.937930', '2022-02-16 15:42:20.937930');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (1, 2022, 2, 1, '2022-02-01', '2022-02-15', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 15:42:20.939546', '2022-02-16 15:42:20.939546');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (2, 2022, 2, 2, '2022-02-16', '2022-02-28', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 15:42:20.939546', '2022-02-16 15:42:20.939546');
INSERT INTO "payrolls" ("id", "tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (1, 9.99, 9.99, 9.99, 0, 1, 1, '2022-02-16 15:42:20.941252', '2022-02-16 15:42:20.941252');
INSERT INTO "payrolls" ("id", "tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (2, 9.99, 9.99, 9.99, 0, 2, 1, '2022-02-16 15:42:20.941252', '2022-02-16 15:42:20.941252');
INSERT INTO "payroll_details" ("id", "quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (980190962, 9.99, 1, 9.99, 9.99, 9.99, 1, 1, '2022-02-16 15:42:20.942672', '2022-02-16 15:42:20.942672');
INSERT INTO "payroll_details" ("id", "quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (298486374, 9.99, 1, 9.99, 9.99, 9.99, 1, 2, '2022-02-16 15:42:20.942672', '2022-02-16 15:42:20.942672')[0m
  [1m[36mTRANSACTION (39.3ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.3ms)[0m  [1m[35mPRAGMA defer_foreign_keys = 0[0m
  [1m[35m (0.2ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.8ms)[0m  [1m[35mPRAGMA foreign_key_check[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_test_isr_calculation
------------------------------------------------
  [1m[36mEmployee Load (2.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_calculate_correctnes
------------------------------------------------
  [1m[36mPayrollPeriod Load (0.9ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.5ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE PayrollPeriod Load (0.0ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE Employee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Create (7.7ms)[0m  [1m[32mINSERT INTO "payrolls" ("tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["tax_amount", 0.0], ["ssn_amount", "[FILTERED]"], ["net_amount", 0.0], ["status", 1], ["employee_id", 1], ["payroll_period_id", 1], ["created_at", "2022-02-16 15:42:21.129281"], ["updated_at", "2022-02-16 15:42:21.129281"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.3ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 1) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mSalary Load (0.5ms)[0m  [1m[34mSELECT "salaries".* FROM "salaries" WHERE (employee_id = 1 and date <= '2022-02-15') ORDER BY date desc LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.4ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.2ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.4ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 15.0], ["concept_type", 1], ["taxed", 8557.5], ["exempt", 0.0], ["retention", 0.0], ["payroll_id", 980190963], ["concept_id", 1], ["created_at", "2022-02-16 15:42:21.202365"], ["updated_at", "2022-02-16 15:42:21.202365"]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.6ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.2ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 8557.5], ["updated_at", "2022-02-16 15:42:32.196729"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.2ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 11) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.1ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.3ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", 42.37], ["payroll_id", 980190963], ["concept_id", 2], ["created_at", "2022-02-16 15:42:32.207683"], ["updated_at", "2022-02-16 15:42:32.207683"]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.3ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "ssn_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["ssn_amount", "[FILTERED]"], ["updated_at", "2022-02-16 15:42:32.803428"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 8515.13], ["updated_at", "2022-02-16 15:42:32.805310"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."taxed") FROM "payroll_details" INNER JOIN "payrolls" ON "payrolls"."id" = "payroll_details"."payroll_id" INNER JOIN "payroll_periods" ON "payroll_periods"."id" = "payrolls"."payroll_period_id" WHERE (payroll_periods.year = 2022 and payroll_periods.month = 2 and payrolls.employee_id = 1)[0m
  [1m[36mConcept Load (0.2ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 10) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.1ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.0ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.2ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", 1121.0490069473685], ["payroll_id", 980190963], ["concept_id", 3], ["created_at", "2022-02-16 15:42:34.264961"], ["updated_at", "2022-02-16 15:42:34.264961"]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "tax_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["tax_amount", 1121.04900694737], ["updated_at", "2022-02-16 15:42:35.384694"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 7394.08099305263], ["updated_at", "2022-02-16 15:42:35.387751"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Sum (0.2ms)[0m  [1m[34mSELECT SUM("payrolls"."net_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.2ms)[0m  [1m[34mSELECT SUM("payrolls"."tax_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."ssn_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayrollPeriod Update (0.2ms)[0m  [1m[33mUPDATE "payroll_periods" SET "tax_amount" = ?, "ssn_amount" = ?, "net_amount" = ?, "updated_at" = ? WHERE "payroll_periods"."id" = ?[0m  [["tax_amount", 1141.03], ["ssn_amount", "[FILTERED]"], ["net_amount", 7414.06], ["updated_at", "2022-02-16 15:42:35.393078"], ["id", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.1ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mPayrollDetail Load (0.2ms)[0m  [1m[34mSELECT "payroll_details".* FROM "payroll_details" WHERE (payroll_id = 980190963) ORDER BY "payroll_details"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mPayrollDetail Load (0.2ms)[0m  [1m[34mSELECT "payroll_details".* FROM "payroll_details" WHERE (payroll_id = 980190963) ORDER BY "payroll_details"."id" ASC LIMIT ? OFFSET ?[0m  [["LIMIT", 1], ["OFFSET", 1]]
  [1m[36mPayrollDetail Load (0.2ms)[0m  [1m[34mSELECT "payroll_details".* FROM "payroll_details" WHERE (payroll_id = 980190963) ORDER BY "payroll_details"."id" ASC LIMIT ? OFFSET ?[0m  [["LIMIT", 1], ["OFFSET", 2]]
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (1.2ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA defer_foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA defer_foreign_keys = ON[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixtures Load (1.9ms)[0m  [1m[31mDELETE FROM "concepts";
DELETE FROM "employees";
DELETE FROM "salaries";
DELETE FROM "attendances";
DELETE FROM "payroll_periods";
DELETE FROM "payrolls";
DELETE FROM "payroll_details";
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (1, 1, 'Salary', 1, 1, '2022-02-16 15:44:14.892415', '2022-02-16 15:44:14.892415');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (2, 11, 'Social Security', 2, 1, '2022-02-16 15:44:14.892415', '2022-02-16 15:44:14.892415');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (3, 10, 'Tax', 2, 1, '2022-02-16 15:44:14.892415', '2022-02-16 15:44:14.892415');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (1, 1, 'Andres', 'Lopez Barboza', '00214258961', 'LOBA881031HK9', 'Q', 'Developer', 1, '2022-02-16 15:44:14.894618', '2022-02-16 15:44:14.894618');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (2, 1, 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 1, '2022-02-16 15:44:14.894618', '2022-02-16 15:44:14.894618');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-01-01', 'A', 570.5, 592.25, 1, '2022-02-16 15:44:14.896201', '2022-02-16 15:44:14.896201');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 'A', 9.99, 9.99, 2, '2022-02-16 15:44:14.896201', '2022-02-16 15:44:14.896201');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 15:44:14.897660', '2022-02-16 15:44:14.897660');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 15:44:14.897660', '2022-02-16 15:44:14.897660');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (1, 2022, 2, 1, '2022-02-01', '2022-02-15', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 15:44:14.899211', '2022-02-16 15:44:14.899211');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (2, 2022, 2, 2, '2022-02-16', '2022-02-28', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 15:44:14.899211', '2022-02-16 15:44:14.899211');
INSERT INTO "payrolls" ("id", "tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (1, 9.99, 9.99, 9.99, 0, 1, 1, '2022-02-16 15:44:14.900847', '2022-02-16 15:44:14.900847');
INSERT INTO "payrolls" ("id", "tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (2, 9.99, 9.99, 9.99, 0, 2, 1, '2022-02-16 15:44:14.900847', '2022-02-16 15:44:14.900847')[0m
  [1m[36mTRANSACTION (34.5ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA defer_foreign_keys = 0[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.3ms)[0m  [1m[35mPRAGMA foreign_key_check[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_test_isr_calculation
------------------------------------------------
  [1m[36mEmployee Load (0.5ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_calculate_correctnes
------------------------------------------------
  [1m[36mPayrollPeriod Load (0.3ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE PayrollPeriod Load (0.0ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE Employee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Create (2.3ms)[0m  [1m[32mINSERT INTO "payrolls" ("tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["tax_amount", 0.0], ["ssn_amount", "[FILTERED]"], ["net_amount", 0.0], ["status", 1], ["employee_id", 1], ["payroll_period_id", 1], ["created_at", "2022-02-16 15:44:15.001919"], ["updated_at", "2022-02-16 15:44:15.001919"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.3ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 1) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mSalary Load (0.5ms)[0m  [1m[34mSELECT "salaries".* FROM "salaries" WHERE (employee_id = 1 and date <= '2022-02-15') ORDER BY date desc LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.2ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.3ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 15.0], ["concept_type", 1], ["taxed", 8557.5], ["exempt", 0.0], ["retention", 0.0], ["payroll_id", 980190963], ["concept_id", 1], ["created_at", "2022-02-16 15:44:15.047519"], ["updated_at", "2022-02-16 15:44:15.047519"]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (0.3ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.2ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 8557.5], ["updated_at", "2022-02-16 15:44:15.061438"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 11) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.0ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.0ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.2ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", 42.37], ["payroll_id", 980190963], ["concept_id", 2], ["created_at", "2022-02-16 15:44:15.065360"], ["updated_at", "2022-02-16 15:44:15.065360"]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "ssn_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["ssn_amount", "[FILTERED]"], ["updated_at", "2022-02-16 15:44:15.070271"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 8515.13], ["updated_at", "2022-02-16 15:44:15.071888"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."taxed") FROM "payroll_details" INNER JOIN "payrolls" ON "payrolls"."id" = "payroll_details"."payroll_id" INNER JOIN "payroll_periods" ON "payroll_periods"."id" = "payrolls"."payroll_period_id" WHERE (payroll_periods.year = 2022 and payroll_periods.month = 2 and payrolls.employee_id = 1)[0m
  [1m[36mConcept Load (0.2ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 10) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.1ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.3ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", 1116.7812789473685], ["payroll_id", 980190963], ["concept_id", 3], ["created_at", "2022-02-16 15:44:19.174145"], ["updated_at", "2022-02-16 15:44:19.174145"]]
  [1m[36mPayrollDetail Sum (0.3ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayroll Update (0.2ms)[0m  [1m[33mUPDATE "payrolls" SET "tax_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["tax_amount", 1116.78127894737], ["updated_at", "2022-02-16 15:44:19.181690"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.6ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.3ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.2ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 7398.34872105263], ["updated_at", "2022-02-16 15:44:19.188864"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Sum (0.2ms)[0m  [1m[34mSELECT SUM("payrolls"."net_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."tax_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."ssn_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayrollPeriod Update (0.2ms)[0m  [1m[33mUPDATE "payroll_periods" SET "tax_amount" = ?, "ssn_amount" = ?, "net_amount" = ?, "updated_at" = ? WHERE "payroll_periods"."id" = ?[0m  [["tax_amount", 1136.76], ["ssn_amount", "[FILTERED]"], ["net_amount", 7418.33], ["updated_at", "2022-02-16 15:44:19.194498"], ["id", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.1ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mPayrollDetail Load (0.2ms)[0m  [1m[34mSELECT "payroll_details".* FROM "payroll_details" WHERE (payroll_id = 980190963) ORDER BY "payroll_details"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mPayrollDetail Load (0.3ms)[0m  [1m[34mSELECT "payroll_details".* FROM "payroll_details" WHERE (payroll_id = 980190963) ORDER BY "payroll_details"."id" ASC LIMIT ? OFFSET ?[0m  [["LIMIT", 1], ["OFFSET", 1]]
  [1m[36mPayrollDetail Load (0.3ms)[0m  [1m[34mSELECT "payroll_details".* FROM "payroll_details" WHERE (payroll_id = 980190963) ORDER BY "payroll_details"."id" ASC LIMIT ? OFFSET ?[0m  [["LIMIT", 1], ["OFFSET", 2]]
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (1.2ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA defer_foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA defer_foreign_keys = ON[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixtures Load (6.2ms)[0m  [1m[31mDELETE FROM "concepts";
DELETE FROM "employees";
DELETE FROM "salaries";
DELETE FROM "attendances";
DELETE FROM "payroll_periods";
DELETE FROM "payrolls";
DELETE FROM "payroll_details";
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (1, 1, 'Salary', 1, 1, '2022-02-16 15:45:09.255063', '2022-02-16 15:45:09.255063');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (2, 11, 'Social Security', 2, 1, '2022-02-16 15:45:09.255063', '2022-02-16 15:45:09.255063');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (3, 10, 'Tax', 2, 1, '2022-02-16 15:45:09.255063', '2022-02-16 15:45:09.255063');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (1, 1, 'Andres', 'Lopez Barboza', '00214258961', 'LOBA881031HK9', 'Q', 'Developer', 1, '2022-02-16 15:45:09.257712', '2022-02-16 15:45:09.257712');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (2, 1, 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 1, '2022-02-16 15:45:09.257712', '2022-02-16 15:45:09.257712');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-01-01', 'A', 570.5, 592.25, 1, '2022-02-16 15:45:09.259338', '2022-02-16 15:45:09.259338');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 'A', 9.99, 9.99, 2, '2022-02-16 15:45:09.259338', '2022-02-16 15:45:09.259338');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 15:45:09.260794', '2022-02-16 15:45:09.260794');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 15:45:09.260794', '2022-02-16 15:45:09.260794');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (1, 2022, 2, 1, '2022-02-01', '2022-02-15', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 15:45:09.262329', '2022-02-16 15:45:09.262329');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (2, 2022, 2, 2, '2022-02-16', '2022-02-28', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 15:45:09.262329', '2022-02-16 15:45:09.262329')[0m
  [1m[36mTRANSACTION (1378.5ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.3ms)[0m  [1m[35mPRAGMA defer_foreign_keys = 0[0m
  [1m[35m (0.9ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (1.2ms)[0m  [1m[35mPRAGMA foreign_key_check[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_test_isr_calculation
------------------------------------------------
  [1m[36mEmployee Load (1.9ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_calculate_correctnes
------------------------------------------------
  [1m[36mPayrollPeriod Load (1.0ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.2ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE PayrollPeriod Load (0.0ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE Employee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Create (17.6ms)[0m  [1m[32mINSERT INTO "payrolls" ("tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["tax_amount", 0.0], ["ssn_amount", "[FILTERED]"], ["net_amount", 0.0], ["status", 1], ["employee_id", 1], ["payroll_period_id", 1], ["created_at", "2022-02-16 15:45:10.775956"], ["updated_at", "2022-02-16 15:45:10.775956"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.2ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 1) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mSalary Load (0.3ms)[0m  [1m[34mSELECT "salaries".* FROM "salaries" WHERE (employee_id = 1 and date <= '2022-02-15') ORDER BY date desc LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.1ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.2ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 15.0], ["concept_type", 1], ["taxed", 8557.5], ["exempt", 0.0], ["retention", 0.0], ["payroll_id", 980190963], ["concept_id", 1], ["created_at", "2022-02-16 15:45:10.819258"], ["updated_at", "2022-02-16 15:45:10.819258"]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.2ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 8557.5], ["updated_at", "2022-02-16 15:45:10.845464"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.2ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 11) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.1ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.3ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", 42.37], ["payroll_id", 980190963], ["concept_id", 2], ["created_at", "2022-02-16 15:45:10.851639"], ["updated_at", "2022-02-16 15:45:10.851639"]]
  [1m[36mPayrollDetail Sum (0.3ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayroll Update (0.2ms)[0m  [1m[33mUPDATE "payrolls" SET "ssn_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["ssn_amount", "[FILTERED]"], ["updated_at", "2022-02-16 15:45:10.861352"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.3ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.2ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 8515.13], ["updated_at", "2022-02-16 15:45:10.864562"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayrollDetail Sum (0.3ms)[0m  [1m[34mSELECT SUM("payroll_details"."taxed") FROM "payroll_details" INNER JOIN "payrolls" ON "payrolls"."id" = "payroll_details"."payroll_id" INNER JOIN "payroll_periods" ON "payroll_periods"."id" = "payrolls"."payroll_period_id" WHERE (payroll_periods.year = 2022 and payroll_periods.month = 2 and payrolls.employee_id = 1)[0m
  [1m[36mConcept Load (0.3ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 10) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.2ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.2ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", 1116.7812789473685], ["payroll_id", 980190963], ["concept_id", 3], ["created_at", "2022-02-16 15:45:14.943859"], ["updated_at", "2022-02-16 15:45:14.943859"]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayroll Update (0.2ms)[0m  [1m[33mUPDATE "payrolls" SET "tax_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["tax_amount", 1116.78127894737], ["updated_at", "2022-02-16 15:45:14.953431"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.3ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.2ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 7398.34872105263], ["updated_at", "2022-02-16 15:45:14.960018"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Sum (0.2ms)[0m  [1m[34mSELECT SUM("payrolls"."net_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.2ms)[0m  [1m[34mSELECT SUM("payrolls"."tax_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.2ms)[0m  [1m[34mSELECT SUM("payrolls"."ssn_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayrollPeriod Update (0.2ms)[0m  [1m[33mUPDATE "payroll_periods" SET "tax_amount" = ?, "ssn_amount" = ?, "net_amount" = ?, "updated_at" = ? WHERE "payroll_periods"."id" = ?[0m  [["tax_amount", 1116.78], ["ssn_amount", "[FILTERED]"], ["net_amount", 7398.35], ["updated_at", "2022-02-16 15:45:14.967705"], ["id", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.1ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mPayrollDetail Load (0.2ms)[0m  [1m[34mSELECT "payroll_details".* FROM "payroll_details" WHERE (payroll_id = 980190963) ORDER BY "payroll_details"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mPayrollDetail Load (0.2ms)[0m  [1m[34mSELECT "payroll_details".* FROM "payroll_details" WHERE (payroll_id = 980190963) ORDER BY "payroll_details"."id" ASC LIMIT ? OFFSET ?[0m  [["LIMIT", 1], ["OFFSET", 1]]
  [1m[36mPayrollDetail Load (0.3ms)[0m  [1m[34mSELECT "payroll_details".* FROM "payroll_details" WHERE (payroll_id = 980190963) ORDER BY "payroll_details"."id" ASC LIMIT ? OFFSET ?[0m  [["LIMIT", 1], ["OFFSET", 2]]
  [1m[36mTRANSACTION (1.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (1.3ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA defer_foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA defer_foreign_keys = ON[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixtures Load (7.3ms)[0m  [1m[31mDELETE FROM "concepts";
DELETE FROM "employees";
DELETE FROM "salaries";
DELETE FROM "attendances";
DELETE FROM "payroll_periods";
DELETE FROM "payrolls";
DELETE FROM "payroll_details";
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (1, 1, 'Salary', 1, 1, '2022-02-16 15:46:24.250255', '2022-02-16 15:46:24.250255');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (2, 11, 'Social Security', 2, 1, '2022-02-16 15:46:24.250255', '2022-02-16 15:46:24.250255');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (3, 10, 'Tax', 2, 1, '2022-02-16 15:46:24.250255', '2022-02-16 15:46:24.250255');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (1, 1, 'Andres', 'Lopez Barboza', '00214258961', 'LOBA881031HK9', 'Q', 'Developer', 1, '2022-02-16 15:46:24.252343', '2022-02-16 15:46:24.252343');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (2, 1, 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 1, '2022-02-16 15:46:24.252343', '2022-02-16 15:46:24.252343');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-01-01', 'A', 570.5, 592.25, 1, '2022-02-16 15:46:24.253944', '2022-02-16 15:46:24.253944');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 'A', 9.99, 9.99, 2, '2022-02-16 15:46:24.253944', '2022-02-16 15:46:24.253944');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 15:46:24.255461', '2022-02-16 15:46:24.255461');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 15:46:24.255461', '2022-02-16 15:46:24.255461');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (1, 2022, 2, 1, '2022-02-01', '2022-02-15', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 15:46:24.257923', '2022-02-16 15:46:24.257923');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (2, 2022, 2, 2, '2022-02-16', '2022-02-28', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 15:46:24.257923', '2022-02-16 15:46:24.257923')[0m
  [1m[36mTRANSACTION (5.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA defer_foreign_keys = 0[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.4ms)[0m  [1m[35mPRAGMA foreign_key_check[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_test_isr_calculation
------------------------------------------------
  [1m[36mEmployee Load (0.3ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_calculate_correctnes
------------------------------------------------
  [1m[36mPayrollPeriod Load (0.4ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE PayrollPeriod Load (0.0ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE Employee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Create (2.8ms)[0m  [1m[32mINSERT INTO "payrolls" ("tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["tax_amount", 0.0], ["ssn_amount", "[FILTERED]"], ["net_amount", 0.0], ["status", 1], ["employee_id", 1], ["payroll_period_id", 1], ["created_at", "2022-02-16 15:46:24.336821"], ["updated_at", "2022-02-16 15:46:24.336821"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.2ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 1) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mSalary Load (0.4ms)[0m  [1m[34mSELECT "salaries".* FROM "salaries" WHERE (employee_id = 1 and date <= '2022-02-15') ORDER BY date desc LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.2ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.2ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.7ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 15.0], ["concept_type", 1], ["taxed", 8557.5], ["exempt", 0.0], ["retention", 0.0], ["payroll_id", 980190963], ["concept_id", 1], ["created_at", "2022-02-16 15:46:24.372483"], ["updated_at", "2022-02-16 15:46:24.372483"]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.3ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 8557.5], ["updated_at", "2022-02-16 15:46:24.392110"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.2ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 11) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.0ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.0ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.3ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", 42.37], ["payroll_id", 980190963], ["concept_id", 2], ["created_at", "2022-02-16 15:46:24.397987"], ["updated_at", "2022-02-16 15:46:24.397987"]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "ssn_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["ssn_amount", "[FILTERED]"], ["updated_at", "2022-02-16 15:46:24.404841"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 8515.13], ["updated_at", "2022-02-16 15:46:24.406467"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."taxed") FROM "payroll_details" INNER JOIN "payrolls" ON "payrolls"."id" = "payroll_details"."payroll_id" INNER JOIN "payroll_periods" ON "payroll_periods"."id" = "payrolls"."payroll_period_id" WHERE (payroll_periods.year = 2022 and payroll_periods.month = 2 and payrolls.employee_id = 1)[0m
  [1m[36mConcept Load (0.2ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 10) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.1ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.3ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", 1116.7812789473685], ["payroll_id", 980190963], ["concept_id", 3], ["created_at", "2022-02-16 15:46:28.715430"], ["updated_at", "2022-02-16 15:46:28.715430"]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.2ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayroll Update (0.2ms)[0m  [1m[33mUPDATE "payrolls" SET "tax_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["tax_amount", 1116.78127894737], ["updated_at", "2022-02-16 15:46:28.727433"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.3ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.2ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 7398.34872105263], ["updated_at", "2022-02-16 15:46:28.737621"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."net_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.2ms)[0m  [1m[34mSELECT SUM("payrolls"."tax_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.3ms)[0m  [1m[34mSELECT SUM("payrolls"."ssn_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayrollPeriod Update (0.6ms)[0m  [1m[33mUPDATE "payroll_periods" SET "tax_amount" = ?, "ssn_amount" = ?, "net_amount" = ?, "updated_at" = ? WHERE "payroll_periods"."id" = ?[0m  [["tax_amount", 1116.78], ["ssn_amount", "[FILTERED]"], ["net_amount", 7398.35], ["updated_at", "2022-02-16 15:46:28.744992"], ["id", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.1ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mTRANSACTION (1.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (1.2ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA defer_foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA defer_foreign_keys = ON[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixtures Load (8.8ms)[0m  [1m[31mDELETE FROM "concepts";
DELETE FROM "employees";
DELETE FROM "salaries";
DELETE FROM "attendances";
DELETE FROM "payroll_periods";
DELETE FROM "payrolls";
DELETE FROM "payroll_details";
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (1, 1, 'Salary', 1, 1, '2022-02-16 15:48:41.361076', '2022-02-16 15:48:41.361076');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (2, 11, 'Social Security', 2, 1, '2022-02-16 15:48:41.361076', '2022-02-16 15:48:41.361076');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (3, 10, 'Tax', 2, 1, '2022-02-16 15:48:41.361076', '2022-02-16 15:48:41.361076');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (1, 1, 'Andres', 'Lopez Barboza', '00214258961', 'LOBA881031HK9', 'Q', 'Developer', 1, '2022-02-16 15:48:41.363082', '2022-02-16 15:48:41.363082');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (2, 1, 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 1, '2022-02-16 15:48:41.363082', '2022-02-16 15:48:41.363082');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-01-01', 'A', 570.5, 592.25, 1, '2022-02-16 15:48:41.364664', '2022-02-16 15:48:41.364664');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 'A', 9.99, 9.99, 2, '2022-02-16 15:48:41.364664', '2022-02-16 15:48:41.364664');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 15:48:41.366919', '2022-02-16 15:48:41.366919');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 15:48:41.366919', '2022-02-16 15:48:41.366919');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (1, 2022, 2, 1, '2022-02-01', '2022-02-15', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 15:48:41.368653', '2022-02-16 15:48:41.368653');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (2, 2022, 2, 2, '2022-02-16', '2022-02-28', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 15:48:41.368653', '2022-02-16 15:48:41.368653')[0m
  [1m[36mTRANSACTION (6.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[35mPRAGMA defer_foreign_keys = 0[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.3ms)[0m  [1m[35mPRAGMA foreign_key_check[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_test_isr_calculation
------------------------------------------------
  [1m[36mEmployee Load (0.3ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_calculate_correctnes
------------------------------------------------
  [1m[36mPayrollPeriod Load (0.3ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE PayrollPeriod Load (0.0ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE Employee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Create (1.6ms)[0m  [1m[32mINSERT INTO "payrolls" ("tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["tax_amount", 0.0], ["ssn_amount", "[FILTERED]"], ["net_amount", 0.0], ["status", 1], ["employee_id", 1], ["payroll_period_id", 1], ["created_at", "2022-02-16 15:48:41.462047"], ["updated_at", "2022-02-16 15:48:41.462047"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.2ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 1) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mSalary Load (0.3ms)[0m  [1m[34mSELECT "salaries".* FROM "salaries" WHERE (employee_id = 1 and date <= '2022-02-15') ORDER BY date desc LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.1ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.2ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 15.0], ["concept_type", 1], ["taxed", 8557.5], ["exempt", 0.0], ["retention", 0.0], ["payroll_id", 980190963], ["concept_id", 1], ["created_at", "2022-02-16 15:48:41.489735"], ["updated_at", "2022-02-16 15:48:41.489735"]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 8557.5], ["updated_at", "2022-02-16 15:48:41.501372"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 11) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.0ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.0ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.2ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", 42.37], ["payroll_id", 980190963], ["concept_id", 2], ["created_at", "2022-02-16 15:48:41.504761"], ["updated_at", "2022-02-16 15:48:41.504761"]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "ssn_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["ssn_amount", "[FILTERED]"], ["updated_at", "2022-02-16 15:48:41.510100"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 8515.13], ["updated_at", "2022-02-16 15:48:41.511624"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."taxed") FROM "payroll_details" INNER JOIN "payrolls" ON "payrolls"."id" = "payroll_details"."payroll_id" INNER JOIN "payroll_periods" ON "payroll_periods"."id" = "payrolls"."payroll_period_id" WHERE (payroll_periods.year = 2022 and payroll_periods.month = 2 and payrolls.employee_id = 1)[0m
  [1m[36mConcept Load (0.2ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 10) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.0ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.0ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.1ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", 1116.7812789473685], ["payroll_id", 980190963], ["concept_id", 3], ["created_at", "2022-02-16 15:48:41.518408"], ["updated_at", "2022-02-16 15:48:41.518408"]]
  [1m[36mPayrollDetail Sum (0.3ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "tax_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["tax_amount", 1116.78127894737], ["updated_at", "2022-02-16 15:48:41.523708"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 7398.34872105263], ["updated_at", "2022-02-16 15:48:41.526669"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."net_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."tax_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."ssn_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayrollPeriod Update (0.2ms)[0m  [1m[33mUPDATE "payroll_periods" SET "tax_amount" = ?, "ssn_amount" = ?, "net_amount" = ?, "updated_at" = ? WHERE "payroll_periods"."id" = ?[0m  [["tax_amount", 1116.78], ["ssn_amount", "[FILTERED]"], ["net_amount", 7398.35], ["updated_at", "2022-02-16 15:48:41.530509"], ["id", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.1ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mPayrollDetail Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (1.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA defer_foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA defer_foreign_keys = ON[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixtures Load (7.4ms)[0m  [1m[31mDELETE FROM "concepts";
DELETE FROM "employees";
DELETE FROM "salaries";
DELETE FROM "attendances";
DELETE FROM "payroll_periods";
DELETE FROM "payrolls";
DELETE FROM "payroll_details";
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (1, 1, 'Salary', 1, 1, '2022-02-16 15:49:06.616277', '2022-02-16 15:49:06.616277');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (2, 11, 'Social Security', 2, 1, '2022-02-16 15:49:06.616277', '2022-02-16 15:49:06.616277');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (3, 10, 'Tax', 2, 1, '2022-02-16 15:49:06.616277', '2022-02-16 15:49:06.616277');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (1, 1, 'Andres', 'Lopez Barboza', '00214258961', 'LOBA881031HK9', 'Q', 'Developer', 1, '2022-02-16 15:49:06.618228', '2022-02-16 15:49:06.618228');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (2, 1, 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 1, '2022-02-16 15:49:06.618228', '2022-02-16 15:49:06.618228');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-01-01', 'A', 570.5, 592.25, 1, '2022-02-16 15:49:06.619833', '2022-02-16 15:49:06.619833');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 'A', 9.99, 9.99, 2, '2022-02-16 15:49:06.619833', '2022-02-16 15:49:06.619833');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 15:49:06.621279', '2022-02-16 15:49:06.621279');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 15:49:06.621279', '2022-02-16 15:49:06.621279');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (1, 2022, 2, 1, '2022-02-01', '2022-02-15', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 15:49:06.622844', '2022-02-16 15:49:06.622844');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (2, 2022, 2, 2, '2022-02-16', '2022-02-28', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 15:49:06.622844', '2022-02-16 15:49:06.622844')[0m
  [1m[36mTRANSACTION (4.2ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[35mPRAGMA defer_foreign_keys = 0[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.5ms)[0m  [1m[35mPRAGMA foreign_key_check[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_test_isr_calculation
------------------------------------------------
  [1m[36mEmployee Load (0.4ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_calculate_correctnes
------------------------------------------------
  [1m[36mPayrollPeriod Load (0.3ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE PayrollPeriod Load (0.0ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE Employee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Create (1.8ms)[0m  [1m[32mINSERT INTO "payrolls" ("tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["tax_amount", 0.0], ["ssn_amount", "[FILTERED]"], ["net_amount", 0.0], ["status", 1], ["employee_id", 1], ["payroll_period_id", 1], ["created_at", "2022-02-16 15:49:06.697527"], ["updated_at", "2022-02-16 15:49:06.697527"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.3ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 1) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mSalary Load (0.3ms)[0m  [1m[34mSELECT "salaries".* FROM "salaries" WHERE (employee_id = 1 and date <= '2022-02-15') ORDER BY date desc LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.1ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.3ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 15.0], ["concept_type", 1], ["taxed", 8557.5], ["exempt", 0.0], ["retention", 0.0], ["payroll_id", 980190963], ["concept_id", 1], ["created_at", "2022-02-16 15:49:06.735708"], ["updated_at", "2022-02-16 15:49:06.735708"]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 8557.5], ["updated_at", "2022-02-16 15:49:06.747431"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 11) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.4ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.3ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", 42.37], ["payroll_id", 980190963], ["concept_id", 2], ["created_at", "2022-02-16 15:49:06.752718"], ["updated_at", "2022-02-16 15:49:06.752718"]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayroll Update (0.2ms)[0m  [1m[33mUPDATE "payrolls" SET "ssn_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["ssn_amount", "[FILTERED]"], ["updated_at", "2022-02-16 15:49:06.759915"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.4ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.2ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 8515.13], ["updated_at", "2022-02-16 15:49:06.763207"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."taxed") FROM "payroll_details" INNER JOIN "payrolls" ON "payrolls"."id" = "payroll_details"."payroll_id" INNER JOIN "payroll_periods" ON "payroll_periods"."id" = "payrolls"."payroll_period_id" WHERE (payroll_periods.year = 2022 and payroll_periods.month = 2 and payrolls.employee_id = 1)[0m
  [1m[36mConcept Load (0.2ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 10) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.0ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.0ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.1ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", 1116.7812789473685], ["payroll_id", 980190963], ["concept_id", 3], ["created_at", "2022-02-16 15:49:06.773073"], ["updated_at", "2022-02-16 15:49:06.773073"]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.0ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "tax_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["tax_amount", 1116.78127894737], ["updated_at", "2022-02-16 15:49:06.776569"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 7398.34872105263], ["updated_at", "2022-02-16 15:49:06.779484"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."net_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."tax_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."ssn_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayrollPeriod Update (0.1ms)[0m  [1m[33mUPDATE "payroll_periods" SET "tax_amount" = ?, "ssn_amount" = ?, "net_amount" = ?, "updated_at" = ? WHERE "payroll_periods"."id" = ?[0m  [["tax_amount", 1116.78], ["ssn_amount", "[FILTERED]"], ["net_amount", 7398.35], ["updated_at", "2022-02-16 15:49:06.783987"], ["id", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.0ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mPayrollDetail Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (1.4ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA defer_foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA defer_foreign_keys = ON[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixtures Load (8.8ms)[0m  [1m[31mDELETE FROM "concepts";
DELETE FROM "employees";
DELETE FROM "salaries";
DELETE FROM "attendances";
DELETE FROM "payroll_periods";
DELETE FROM "payrolls";
DELETE FROM "payroll_details";
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (1, 1, 'Salary', 1, 1, '2022-02-16 15:49:48.246653', '2022-02-16 15:49:48.246653');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (2, 11, 'Social Security', 2, 1, '2022-02-16 15:49:48.246653', '2022-02-16 15:49:48.246653');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (3, 10, 'Tax', 2, 1, '2022-02-16 15:49:48.246653', '2022-02-16 15:49:48.246653');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (1, 1, 'Andres', 'Lopez Barboza', '00214258961', 'LOBA881031HK9', 'Q', 'Developer', 1, '2022-02-16 15:49:48.248779', '2022-02-16 15:49:48.248779');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (2, 1, 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 1, '2022-02-16 15:49:48.248779', '2022-02-16 15:49:48.248779');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-01-01', 'A', 570.5, 592.25, 1, '2022-02-16 15:49:48.250356', '2022-02-16 15:49:48.250356');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 'A', 9.99, 9.99, 2, '2022-02-16 15:49:48.250356', '2022-02-16 15:49:48.250356');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 15:49:48.251807', '2022-02-16 15:49:48.251807');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 15:49:48.251807', '2022-02-16 15:49:48.251807');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (1, 2022, 2, 1, '2022-02-01', '2022-02-15', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 15:49:48.253373', '2022-02-16 15:49:48.253373');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (2, 2022, 2, 2, '2022-02-16', '2022-02-28', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 15:49:48.253373', '2022-02-16 15:49:48.253373')[0m
  [1m[36mTRANSACTION (4.4ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA defer_foreign_keys = 0[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.4ms)[0m  [1m[35mPRAGMA foreign_key_check[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_test_isr_calculation
------------------------------------------------
  [1m[36mEmployee Load (0.3ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_calculate_correctnes
------------------------------------------------
  [1m[36mPayrollPeriod Load (0.5ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE PayrollPeriod Load (0.0ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE Employee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Create (1.3ms)[0m  [1m[32mINSERT INTO "payrolls" ("tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["tax_amount", 0.0], ["ssn_amount", "[FILTERED]"], ["net_amount", 0.0], ["status", 1], ["employee_id", 1], ["payroll_period_id", 1], ["created_at", "2022-02-16 15:49:48.331265"], ["updated_at", "2022-02-16 15:49:48.331265"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.2ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 1) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mSalary Load (0.3ms)[0m  [1m[34mSELECT "salaries".* FROM "salaries" WHERE (employee_id = 1 and date <= '2022-02-15') ORDER BY date desc LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.2ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.2ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 15.0], ["concept_type", 1], ["taxed", 8557.5], ["exempt", 0.0], ["retention", 0.0], ["payroll_id", 980190963], ["concept_id", 1], ["created_at", "2022-02-16 15:49:48.356918"], ["updated_at", "2022-02-16 15:49:48.356918"]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 8557.5], ["updated_at", "2022-02-16 15:49:48.371963"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 11) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.0ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.0ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.1ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", 42.37], ["payroll_id", 980190963], ["concept_id", 2], ["created_at", "2022-02-16 15:49:48.375390"], ["updated_at", "2022-02-16 15:49:48.375390"]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.0ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "ssn_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["ssn_amount", "[FILTERED]"], ["updated_at", "2022-02-16 15:49:48.379931"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 8515.13], ["updated_at", "2022-02-16 15:49:48.381541"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."taxed") FROM "payroll_details" INNER JOIN "payrolls" ON "payrolls"."id" = "payroll_details"."payroll_id" INNER JOIN "payroll_periods" ON "payroll_periods"."id" = "payrolls"."payroll_period_id" WHERE (payroll_periods.year = 2022 and payroll_periods.month = 2 and payrolls.employee_id = 1)[0m
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 10) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.0ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.0ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.1ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", 1116.7812789473685], ["payroll_id", 980190963], ["concept_id", 3], ["created_at", "2022-02-16 15:49:48.388989"], ["updated_at", "2022-02-16 15:49:48.388989"]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.0ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "tax_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["tax_amount", 1116.78127894737], ["updated_at", "2022-02-16 15:49:48.392370"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 7398.34872105263], ["updated_at", "2022-02-16 15:49:48.395065"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."net_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."tax_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."ssn_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayrollPeriod Update (0.2ms)[0m  [1m[33mUPDATE "payroll_periods" SET "tax_amount" = ?, "ssn_amount" = ?, "net_amount" = ?, "updated_at" = ? WHERE "payroll_periods"."id" = ?[0m  [["tax_amount", 1116.78], ["ssn_amount", "[FILTERED]"], ["net_amount", 7398.35], ["updated_at", "2022-02-16 15:49:48.398827"], ["id", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.0ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mPayrollDetail Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (1.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA defer_foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA defer_foreign_keys = ON[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixtures Load (7.9ms)[0m  [1m[31mDELETE FROM "concepts";
DELETE FROM "employees";
DELETE FROM "salaries";
DELETE FROM "attendances";
DELETE FROM "payroll_periods";
DELETE FROM "payrolls";
DELETE FROM "payroll_details";
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (1, 1, 'Salary', 1, 1, '2022-02-16 15:50:47.765891', '2022-02-16 15:50:47.765891');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (2, 11, 'Social Security', 2, 1, '2022-02-16 15:50:47.765891', '2022-02-16 15:50:47.765891');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (3, 10, 'Tax', 2, 1, '2022-02-16 15:50:47.765891', '2022-02-16 15:50:47.765891');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (1, 1, 'Andres', 'Lopez Barboza', '00214258961', 'LOBA881031HK9', 'Q', 'Developer', 1, '2022-02-16 15:50:47.767880', '2022-02-16 15:50:47.767880');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (2, 1, 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 1, '2022-02-16 15:50:47.767880', '2022-02-16 15:50:47.767880');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-01-01', 'A', 570.5, 592.25, 1, '2022-02-16 15:50:47.769481', '2022-02-16 15:50:47.769481');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 'A', 9.99, 9.99, 2, '2022-02-16 15:50:47.769481', '2022-02-16 15:50:47.769481');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 15:50:47.772176', '2022-02-16 15:50:47.772176');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 15:50:47.772176', '2022-02-16 15:50:47.772176');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (1, 2022, 2, 1, '2022-02-01', '2022-02-15', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 15:50:47.796652', '2022-02-16 15:50:47.796652');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (2, 2022, 2, 2, '2022-02-16', '2022-02-28', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 15:50:47.796652', '2022-02-16 15:50:47.796652')[0m
  [1m[36mTRANSACTION (3.5ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA defer_foreign_keys = 0[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.3ms)[0m  [1m[35mPRAGMA foreign_key_check[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_test_isr_calculation
------------------------------------------------
  [1m[36mEmployee Load (0.5ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_calculate_correctnes
------------------------------------------------
  [1m[36mPayrollPeriod Load (0.6ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE PayrollPeriod Load (0.0ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE Employee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Create (2.0ms)[0m  [1m[32mINSERT INTO "payrolls" ("tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["tax_amount", 0.0], ["ssn_amount", "[FILTERED]"], ["net_amount", 0.0], ["status", 1], ["employee_id", 1], ["payroll_period_id", 1], ["created_at", "2022-02-16 15:50:47.905968"], ["updated_at", "2022-02-16 15:50:47.905968"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.2ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 1) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mSalary Load (0.3ms)[0m  [1m[34mSELECT "salaries".* FROM "salaries" WHERE (employee_id = 1 and date <= '2022-02-15') ORDER BY date desc LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.1ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.2ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 15.0], ["concept_type", 1], ["taxed", 8557.5], ["exempt", 0.0], ["retention", 0.0], ["payroll_id", 980190963], ["concept_id", 1], ["created_at", "2022-02-16 15:50:47.934104"], ["updated_at", "2022-02-16 15:50:47.934104"]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 8557.5], ["updated_at", "2022-02-16 15:50:47.948317"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 11) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.0ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.0ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.1ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", 42.37], ["payroll_id", 980190963], ["concept_id", 2], ["created_at", "2022-02-16 15:50:47.951652"], ["updated_at", "2022-02-16 15:50:47.951652"]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.0ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "ssn_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["ssn_amount", "[FILTERED]"], ["updated_at", "2022-02-16 15:50:47.956101"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.2ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 8515.13], ["updated_at", "2022-02-16 15:50:47.957576"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."taxed") FROM "payroll_details" INNER JOIN "payrolls" ON "payrolls"."id" = "payroll_details"."payroll_id" INNER JOIN "payroll_periods" ON "payroll_periods"."id" = "payrolls"."payroll_period_id" WHERE (payroll_periods.year = 2022 and payroll_periods.month = 2 and payrolls.employee_id = 1)[0m
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 10) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.0ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.0ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.1ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", 1116.7812789473685], ["payroll_id", 980190963], ["concept_id", 3], ["created_at", "2022-02-16 15:50:47.964427"], ["updated_at", "2022-02-16 15:50:47.964427"]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.0ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "tax_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["tax_amount", 1116.78127894737], ["updated_at", "2022-02-16 15:50:47.967653"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 7398.34872105263], ["updated_at", "2022-02-16 15:50:47.970192"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."net_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."tax_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."ssn_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayrollPeriod Update (0.2ms)[0m  [1m[33mUPDATE "payroll_periods" SET "tax_amount" = ?, "ssn_amount" = ?, "net_amount" = ?, "updated_at" = ? WHERE "payroll_periods"."id" = ?[0m  [["tax_amount", 1116.78], ["ssn_amount", "[FILTERED]"], ["net_amount", 7398.35], ["updated_at", "2022-02-16 15:50:47.974333"], ["id", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.1ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mPayrollDetail Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayrollDetail Load (0.2ms)[0m  [1m[34mSELECT "payroll_details".* FROM "payroll_details" WHERE (payroll_id = 980190963) ORDER BY "payroll_details"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (1.2ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA defer_foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA defer_foreign_keys = ON[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixtures Load (8.7ms)[0m  [1m[31mDELETE FROM "concepts";
DELETE FROM "employees";
DELETE FROM "salaries";
DELETE FROM "attendances";
DELETE FROM "payroll_periods";
DELETE FROM "payrolls";
DELETE FROM "payroll_details";
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (1, 1, 'Salary', 1, 1, '2022-02-16 15:51:08.327923', '2022-02-16 15:51:08.327923');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (2, 11, 'Social Security', 2, 1, '2022-02-16 15:51:08.327923', '2022-02-16 15:51:08.327923');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (3, 10, 'Tax', 2, 1, '2022-02-16 15:51:08.327923', '2022-02-16 15:51:08.327923');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (1, 1, 'Andres', 'Lopez Barboza', '00214258961', 'LOBA881031HK9', 'Q', 'Developer', 1, '2022-02-16 15:51:08.330320', '2022-02-16 15:51:08.330320');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (2, 1, 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 1, '2022-02-16 15:51:08.330320', '2022-02-16 15:51:08.330320');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-01-01', 'A', 570.5, 592.25, 1, '2022-02-16 15:51:08.332021', '2022-02-16 15:51:08.332021');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 'A', 9.99, 9.99, 2, '2022-02-16 15:51:08.332021', '2022-02-16 15:51:08.332021');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 15:51:08.333495', '2022-02-16 15:51:08.333495');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 15:51:08.333495', '2022-02-16 15:51:08.333495');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (1, 2022, 2, 1, '2022-02-01', '2022-02-15', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 15:51:08.335167', '2022-02-16 15:51:08.335167');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (2, 2022, 2, 2, '2022-02-16', '2022-02-28', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 15:51:08.335167', '2022-02-16 15:51:08.335167')[0m
  [1m[36mTRANSACTION (4.2ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA defer_foreign_keys = 0[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.3ms)[0m  [1m[35mPRAGMA foreign_key_check[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_test_isr_calculation
------------------------------------------------
  [1m[36mEmployee Load (0.3ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_calculate_correctnes
------------------------------------------------
  [1m[36mPayrollPeriod Load (0.3ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE PayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE Employee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Create (1.6ms)[0m  [1m[32mINSERT INTO "payrolls" ("tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["tax_amount", 0.0], ["ssn_amount", "[FILTERED]"], ["net_amount", 0.0], ["status", 1], ["employee_id", 1], ["payroll_period_id", 1], ["created_at", "2022-02-16 15:51:08.412713"], ["updated_at", "2022-02-16 15:51:08.412713"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 1) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mSalary Load (0.3ms)[0m  [1m[34mSELECT "salaries".* FROM "salaries" WHERE (employee_id = 1 and date <= '2022-02-15') ORDER BY date desc LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.2ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.3ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 15.0], ["concept_type", 1], ["taxed", 8557.5], ["exempt", 0.0], ["retention", 0.0], ["payroll_id", 980190963], ["concept_id", 1], ["created_at", "2022-02-16 15:51:08.441185"], ["updated_at", "2022-02-16 15:51:08.441185"]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 8557.5], ["updated_at", "2022-02-16 15:51:08.468117"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.2ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 11) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.1ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.2ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", 42.37], ["payroll_id", 980190963], ["concept_id", 2], ["created_at", "2022-02-16 15:51:08.472998"], ["updated_at", "2022-02-16 15:51:08.472998"]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "ssn_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["ssn_amount", "[FILTERED]"], ["updated_at", "2022-02-16 15:51:08.479424"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 8515.13], ["updated_at", "2022-02-16 15:51:08.481114"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."taxed") FROM "payroll_details" INNER JOIN "payrolls" ON "payrolls"."id" = "payroll_details"."payroll_id" INNER JOIN "payroll_periods" ON "payroll_periods"."id" = "payrolls"."payroll_period_id" WHERE (payroll_periods.year = 2022 and payroll_periods.month = 2 and payrolls.employee_id = 1)[0m
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 10) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.0ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.0ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.2ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", 1116.7812789473685], ["payroll_id", 980190963], ["concept_id", 3], ["created_at", "2022-02-16 15:51:08.488095"], ["updated_at", "2022-02-16 15:51:08.488095"]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "tax_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["tax_amount", 1116.78127894737], ["updated_at", "2022-02-16 15:51:08.492545"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 7398.34872105263], ["updated_at", "2022-02-16 15:51:08.495420"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."net_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."tax_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."ssn_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayrollPeriod Update (0.2ms)[0m  [1m[33mUPDATE "payroll_periods" SET "tax_amount" = ?, "ssn_amount" = ?, "net_amount" = ?, "updated_at" = ? WHERE "payroll_periods"."id" = ?[0m  [["tax_amount", 1116.78], ["ssn_amount", "[FILTERED]"], ["net_amount", 7398.35], ["updated_at", "2022-02-16 15:51:08.499077"], ["id", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.0ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mPayrollDetail Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayrollDetail Load (0.1ms)[0m  [1m[34mSELECT "payroll_details".* FROM "payroll_details" WHERE (payroll_id = 980190963) ORDER BY "payroll_details"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (1.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA defer_foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA defer_foreign_keys = ON[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixtures Load (7.9ms)[0m  [1m[31mDELETE FROM "concepts";
DELETE FROM "employees";
DELETE FROM "salaries";
DELETE FROM "attendances";
DELETE FROM "payroll_periods";
DELETE FROM "payrolls";
DELETE FROM "payroll_details";
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (1, 1, 'Salary', 1, 1, '2022-02-16 15:51:51.547365', '2022-02-16 15:51:51.547365');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (2, 11, 'Social Security', 2, 1, '2022-02-16 15:51:51.547365', '2022-02-16 15:51:51.547365');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (3, 10, 'Tax', 2, 1, '2022-02-16 15:51:51.547365', '2022-02-16 15:51:51.547365');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (1, 1, 'Andres', 'Lopez Barboza', '00214258961', 'LOBA881031HK9', 'Q', 'Developer', 1, '2022-02-16 15:51:51.549370', '2022-02-16 15:51:51.549370');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (2, 1, 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 1, '2022-02-16 15:51:51.549370', '2022-02-16 15:51:51.549370');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-01-01', 'A', 570.5, 592.25, 1, '2022-02-16 15:51:51.551674', '2022-02-16 15:51:51.551674');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 'A', 9.99, 9.99, 2, '2022-02-16 15:51:51.551674', '2022-02-16 15:51:51.551674');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 15:51:51.553824', '2022-02-16 15:51:51.553824');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 15:51:51.553824', '2022-02-16 15:51:51.553824');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (1, 2022, 2, 1, '2022-02-01', '2022-02-15', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 15:51:51.555455', '2022-02-16 15:51:51.555455');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (2, 2022, 2, 2, '2022-02-16', '2022-02-28', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 15:51:51.555455', '2022-02-16 15:51:51.555455')[0m
  [1m[36mTRANSACTION (3.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA defer_foreign_keys = 0[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.3ms)[0m  [1m[35mPRAGMA foreign_key_check[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_test_isr_calculation
------------------------------------------------
  [1m[36mEmployee Load (0.3ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_calculate_correctnes
------------------------------------------------
  [1m[36mPayrollPeriod Load (2.0ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE PayrollPeriod Load (0.0ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE Employee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Create (1.2ms)[0m  [1m[32mINSERT INTO "payrolls" ("tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["tax_amount", 0.0], ["ssn_amount", "[FILTERED]"], ["net_amount", 0.0], ["status", 1], ["employee_id", 1], ["payroll_period_id", 1], ["created_at", "2022-02-16 15:51:51.641234"], ["updated_at", "2022-02-16 15:51:51.641234"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.2ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 1) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mSalary Load (0.7ms)[0m  [1m[34mSELECT "salaries".* FROM "salaries" WHERE (employee_id = 1 and date <= '2022-02-15') ORDER BY date desc LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.1ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.3ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 15.0], ["concept_type", 1], ["taxed", 8557.5], ["exempt", 0.0], ["retention", 0.0], ["payroll_id", 980190963], ["concept_id", 1], ["created_at", "2022-02-16 15:51:51.674187"], ["updated_at", "2022-02-16 15:51:51.674187"]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.2ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 8557.5], ["updated_at", "2022-02-16 15:51:51.692352"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 11) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.0ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.0ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.1ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", 42.37], ["payroll_id", 980190963], ["concept_id", 2], ["created_at", "2022-02-16 15:51:51.696177"], ["updated_at", "2022-02-16 15:51:51.696177"]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.0ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "ssn_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["ssn_amount", "[FILTERED]"], ["updated_at", "2022-02-16 15:51:51.701173"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 8515.13], ["updated_at", "2022-02-16 15:51:51.702879"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."taxed") FROM "payroll_details" INNER JOIN "payrolls" ON "payrolls"."id" = "payroll_details"."payroll_id" INNER JOIN "payroll_periods" ON "payroll_periods"."id" = "payrolls"."payroll_period_id" WHERE (payroll_periods.year = 2022 and payroll_periods.month = 2 and payrolls.employee_id = 1)[0m
  [1m[36mConcept Load (0.4ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 10) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.1ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.0ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.2ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", 1116.7812789473685], ["payroll_id", 980190963], ["concept_id", 3], ["created_at", "2022-02-16 15:51:51.711007"], ["updated_at", "2022-02-16 15:51:51.711007"]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.0ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "tax_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["tax_amount", 1116.78127894737], ["updated_at", "2022-02-16 15:51:51.714849"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 7398.34872105263], ["updated_at", "2022-02-16 15:51:51.717693"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."net_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."tax_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."ssn_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayrollPeriod Update (0.1ms)[0m  [1m[33mUPDATE "payroll_periods" SET "tax_amount" = ?, "ssn_amount" = ?, "net_amount" = ?, "updated_at" = ? WHERE "payroll_periods"."id" = ?[0m  [["tax_amount", 1116.78], ["ssn_amount", "[FILTERED]"], ["net_amount", 7398.35], ["updated_at", "2022-02-16 15:51:51.721373"], ["id", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.1ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mPayrollDetail Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayrollDetail Load (0.1ms)[0m  [1m[34mSELECT "payroll_details".* FROM "payroll_details" WHERE (payroll_id = 980190963) ORDER BY "payroll_details"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mPayrollDetail Load (0.2ms)[0m  [1m[34mSELECT "payroll_details".* FROM "payroll_details" WHERE (payroll_id = 980190963) ORDER BY "payroll_details"."id" ASC LIMIT ? OFFSET ?[0m  [["LIMIT", 1], ["OFFSET", 1]]
  [1m[36mPayrollDetail Load (0.2ms)[0m  [1m[34mSELECT "payroll_details".* FROM "payroll_details" WHERE (payroll_id = 980190963) ORDER BY "payroll_details"."id" ASC LIMIT ? OFFSET ?[0m  [["LIMIT", 1], ["OFFSET", 2]]
  [1m[36mTRANSACTION (1.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (1.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.7ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA defer_foreign_keys[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA defer_foreign_keys = ON[0m
  [1m[35m (0.0ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixtures Load (11.0ms)[0m  [1m[31mDELETE FROM "concepts";
DELETE FROM "employees";
DELETE FROM "salaries";
DELETE FROM "attendances";
DELETE FROM "payroll_periods";
DELETE FROM "payrolls";
DELETE FROM "payroll_details";
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (1, 1, 'Salary', 1, 1, '2022-02-16 16:03:09.336065', '2022-02-16 16:03:09.336065');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (2, 11, 'Social Security', 2, 1, '2022-02-16 16:03:09.336065', '2022-02-16 16:03:09.336065');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (3, 10, 'Tax', 2, 1, '2022-02-16 16:03:09.336065', '2022-02-16 16:03:09.336065');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (1, 1, 'Andres', 'Lopez Barboza', '00214258961', 'LOBA881031HK9', 'Q', 'Developer', 1, '2022-02-16 16:03:09.338033', '2022-02-16 16:03:09.338033');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (2, 1, 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 1, '2022-02-16 16:03:09.338033', '2022-02-16 16:03:09.338033');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-01-01', 'A', 570.5, 592.25, 1, '2022-02-16 16:03:09.339577', '2022-02-16 16:03:09.339577');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 'A', 9.99, 9.99, 2, '2022-02-16 16:03:09.339577', '2022-02-16 16:03:09.339577');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 16:03:09.341057', '2022-02-16 16:03:09.341057');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 16:03:09.341057', '2022-02-16 16:03:09.341057');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (1, 2022, 2, 1, '2022-02-01', '2022-02-15', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 16:03:09.342589', '2022-02-16 16:03:09.342589');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (2, 2022, 2, 2, '2022-02-16', '2022-02-28', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 16:03:09.342589', '2022-02-16 16:03:09.342589')[0m
  [1m[36mTRANSACTION (5.5ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA defer_foreign_keys = 0[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.6ms)[0m  [1m[35mPRAGMA foreign_key_check[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_test_isr_calculation
------------------------------------------------
  [1m[36mEmployee Load (0.3ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_calculate_correctnes
------------------------------------------------
  [1m[36mPayrollPeriod Load (0.5ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (1.2ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE PayrollPeriod Load (0.0ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE Employee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Create (1.3ms)[0m  [1m[32mINSERT INTO "payrolls" ("tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["tax_amount", 0.0], ["ssn_amount", "[FILTERED]"], ["net_amount", 0.0], ["status", 1], ["employee_id", 1], ["payroll_period_id", 1], ["created_at", "2022-02-16 16:03:09.462917"], ["updated_at", "2022-02-16 16:03:09.462917"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.2ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 1) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mSalary Load (0.3ms)[0m  [1m[34mSELECT "salaries".* FROM "salaries" WHERE (employee_id = 1 and date <= '2022-02-15') ORDER BY date desc LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.2ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.2ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 15.0], ["concept_type", 1], ["taxed", 8557.5], ["exempt", 0.0], ["retention", 0.0], ["payroll_id", 980190963], ["concept_id", 1], ["created_at", "2022-02-16 16:03:09.502438"], ["updated_at", "2022-02-16 16:03:09.502438"]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 8557.5], ["updated_at", "2022-02-16 16:03:09.521766"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 11) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.0ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.0ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.2ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", 42.37], ["payroll_id", 980190963], ["concept_id", 2], ["created_at", "2022-02-16 16:03:09.525475"], ["updated_at", "2022-02-16 16:03:09.525475"]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.0ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "ssn_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["ssn_amount", "[FILTERED]"], ["updated_at", "2022-02-16 16:03:09.530197"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.2ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 8515.13], ["updated_at", "2022-02-16 16:03:09.532817"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."taxed") FROM "payroll_details" INNER JOIN "payrolls" ON "payrolls"."id" = "payroll_details"."payroll_id" INNER JOIN "payroll_periods" ON "payroll_periods"."id" = "payrolls"."payroll_period_id" WHERE (payroll_periods.year = 2022 and payroll_periods.month = 2 and payrolls.employee_id = 1)[0m
  [1m[36mConcept Load (0.2ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 10) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.0ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.0ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.2ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", 1116.7812789473685], ["payroll_id", 980190963], ["concept_id", 3], ["created_at", "2022-02-16 16:03:09.542637"], ["updated_at", "2022-02-16 16:03:09.542637"]]
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.0ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayroll Update (0.2ms)[0m  [1m[33mUPDATE "payrolls" SET "tax_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["tax_amount", 1116.78127894737], ["updated_at", "2022-02-16 16:03:09.546244"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 7398.34872105263], ["updated_at", "2022-02-16 16:03:09.549407"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."net_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."tax_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."ssn_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayrollPeriod Update (0.2ms)[0m  [1m[33mUPDATE "payroll_periods" SET "tax_amount" = ?, "ssn_amount" = ?, "net_amount" = ?, "updated_at" = ? WHERE "payroll_periods"."id" = ?[0m  [["tax_amount", 1116.78], ["ssn_amount", "[FILTERED]"], ["net_amount", 7398.35], ["updated_at", "2022-02-16 16:03:09.553242"], ["id", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.0ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mPayrollDetail Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
-------------------------------------------------------------
ConceptTest: test_product_is_not_valid_without_a_unique_title
-------------------------------------------------------------
  [1m[36mConcept Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "concepts" WHERE "concepts"."code" = ? LIMIT ?[0m  [["code", 1], ["LIMIT", 1]]
  [1m[36mCACHE Concept Exists? (0.0ms)[0m  [1m[34mSELECT 1 AS one FROM "concepts" WHERE "concepts"."code" = ? LIMIT ?[0m  [["code", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (4.7ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA defer_foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA defer_foreign_keys = ON[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mFixtures Load (2.6ms)[0m  [1m[31mDELETE FROM "concepts";
DELETE FROM "employees";
DELETE FROM "salaries";
DELETE FROM "attendances";
DELETE FROM "payroll_periods";
DELETE FROM "payrolls";
DELETE FROM "payroll_details";
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (1, 1, 'Salary', 1, 1, '2022-02-16 16:07:24.371781', '2022-02-16 16:07:24.371781');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (2, 11, 'Social Security', 2, 1, '2022-02-16 16:07:24.371781', '2022-02-16 16:07:24.371781');
INSERT INTO "concepts" ("id", "code", "name", "concept_type", "active", "created_at", "updated_at") VALUES (3, 10, 'Tax', 2, 1, '2022-02-16 16:07:24.371781', '2022-02-16 16:07:24.371781');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (1, 1, 'Andres', 'Lopez Barboza', '00214258961', 'LOBA881031HK9', 'Q', 'Developer', 1, '2022-02-16 16:07:24.375077', '2022-02-16 16:07:24.375077');
INSERT INTO "employees" ("id", "code", "first_name", "last_name", "ssn", "tax_id", "payment_period", "job", "active", "created_at", "updated_at") VALUES (2, 1, 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', 1, '2022-02-16 16:07:24.375077', '2022-02-16 16:07:24.375077');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-01-01', 'A', 570.5, 592.25, 1, '2022-02-16 16:07:24.378276', '2022-02-16 16:07:24.378276');
INSERT INTO "salaries" ("id", "date", "salary_type", "sdn", "sdi", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 'A', 9.99, 9.99, 2, '2022-02-16 16:07:24.378276', '2022-02-16 16:07:24.378276');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (980190962, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 16:07:24.383516', '2022-02-16 16:07:24.383516');
INSERT INTO "attendances" ("id", "date", "sdn", "sdi", "status", "employee_id", "created_at", "updated_at") VALUES (298486374, '2022-02-06', 9.99, 9.99, 1, 1, '2022-02-16 16:07:24.383516', '2022-02-16 16:07:24.383516');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (1, 2022, 2, 1, '2022-02-01', '2022-02-15', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 16:07:24.386292', '2022-02-16 16:07:24.386292');
INSERT INTO "payroll_periods" ("id", "year", "month", "consecutive", "start_date", "end_date", "payroll_period", "tax_amount", "ssn_amount", "net_amount", "status", "application_status", "active", "created_at", "updated_at") VALUES (2, 2022, 2, 2, '2022-02-16', '2022-02-28', 'Q', 0.0, 0.0, 0.0, 0, 0, 1, '2022-02-16 16:07:24.386292', '2022-02-16 16:07:24.386292')[0m
  [1m[36mTRANSACTION (5.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA defer_foreign_keys = 0[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[35m (0.7ms)[0m  [1m[35mPRAGMA foreign_key_check[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------------------
ConceptTest: test_concept_is_not_valid_without_a_unique_code
------------------------------------------------------------
  [1m[36mConcept Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "concepts" WHERE "concepts"."code" = ? LIMIT ?[0m  [["code", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_test_isr_calculation
------------------------------------------------
  [1m[36mEmployee Load (0.4ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
------------------------------------------------
PayrollCalculatorTest: test_calculate_correctnes
------------------------------------------------
  [1m[36mPayrollPeriod Load (0.4ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE PayrollPeriod Load (0.0ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCACHE Employee Load (0.0ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Create (1.2ms)[0m  [1m[32mINSERT INTO "payrolls" ("tax_amount", "ssn_amount", "net_amount", "status", "employee_id", "payroll_period_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["tax_amount", 0.0], ["ssn_amount", "[FILTERED]"], ["net_amount", 0.0], ["status", 1], ["employee_id", 1], ["payroll_period_id", 1], ["created_at", "2022-02-16 16:07:24.530199"], ["updated_at", "2022-02-16 16:07:24.530199"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.2ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 1) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mSalary Load (0.2ms)[0m  [1m[34mSELECT "salaries".* FROM "salaries" WHERE (employee_id = 1 and date <= '2022-02-15') ORDER BY date desc LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.1ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.2ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.4ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 15.0], ["concept_type", 1], ["taxed", 8557.5], ["exempt", 0.0], ["retention", 0.0], ["payroll_id", 980190963], ["concept_id", 1], ["created_at", "2022-02-16 16:07:24.553778"], ["updated_at", "2022-02-16 16:07:24.553778"]]
  [1m[36mPayrollDetail Sum (0.3ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 8557.5], ["updated_at", "2022-02-16 16:07:24.573572"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 11) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.0ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.0ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.2ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", 42.37], ["payroll_id", 980190963], ["concept_id", 2], ["created_at", "2022-02-16 16:07:24.577339"], ["updated_at", "2022-02-16 16:07:24.577339"]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.1ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayroll Update (0.2ms)[0m  [1m[33mUPDATE "payrolls" SET "ssn_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["ssn_amount", "[FILTERED]"], ["updated_at", "2022-02-16 16:07:24.583811"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.2ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 8515.13], ["updated_at", "2022-02-16 16:07:24.588213"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."taxed") FROM "payroll_details" INNER JOIN "payrolls" ON "payrolls"."id" = "payroll_details"."payroll_id" INNER JOIN "payroll_periods" ON "payroll_periods"."id" = "payrolls"."payroll_period_id" WHERE (payroll_periods.year = 2022 and payroll_periods.month = 2 and payrolls.employee_id = 1)[0m
  [1m[36mConcept Load (0.2ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE (code = 10) ORDER BY "concepts"."id" ASC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.1ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mConcept Load (0.1ms)[0m  [1m[34mSELECT "concepts".* FROM "concepts" WHERE "concepts"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mPayrollDetail Create (0.2ms)[0m  [1m[32mINSERT INTO "payroll_details" ("quantity", "concept_type", "taxed", "exempt", "retention", "payroll_id", "concept_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["quantity", 1.0], ["concept_type", 2], ["taxed", 0.0], ["exempt", 0.0], ["retention", 1116.7812789473685], ["payroll_id", 980190963], ["concept_id", 3], ["created_at", "2022-02-16 16:07:24.612351"], ["updated_at", "2022-02-16 16:07:24.612351"]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 10)[0m
  [1m[36mPayrollPeriod Load (0.2ms)[0m  [1m[34mSELECT "payroll_periods".* FROM "payroll_periods" WHERE "payroll_periods"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEmployee Load (0.1ms)[0m  [1m[34mSELECT "employees".* FROM "employees" WHERE "employees"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mPayroll Update (0.2ms)[0m  [1m[33mUPDATE "payrolls" SET "tax_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["tax_amount", 1116.78127894737], ["updated_at", "2022-02-16 16:07:24.618701"], ["id", 980190963]]
  [1m[36mPayrollDetail Sum (0.2ms)[0m  [1m[34mSELECT SUM("payroll_details"."retention") FROM "payroll_details" INNER JOIN "concepts" ON "concepts"."id" = "payroll_details"."concept_id" WHERE (payroll_id = 980190963 and concepts.code = 11)[0m
  [1m[36mPayrollDetail Sum (0.1ms)[0m  [1m[34mSELECT SUM(payroll_details.taxed + payroll_details.exempt - payroll_details.retention) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mPayroll Update (0.1ms)[0m  [1m[33mUPDATE "payrolls" SET "net_amount" = ?, "updated_at" = ? WHERE "payrolls"."id" = ?[0m  [["net_amount", 7398.34872105263], ["updated_at", "2022-02-16 16:07:24.622957"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."net_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."tax_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mPayroll Sum (0.1ms)[0m  [1m[34mSELECT SUM("payrolls"."ssn_amount") FROM "payrolls" WHERE (payrolls.payroll_period_id = 1)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPayrollPeriod Update (0.2ms)[0m  [1m[33mUPDATE "payroll_periods" SET "tax_amount" = ?, "ssn_amount" = ?, "net_amount" = ?, "updated_at" = ? WHERE "payroll_periods"."id" = ?[0m  [["tax_amount", 1116.78], ["ssn_amount", "[FILTERED]"], ["net_amount", 7398.35], ["updated_at", "2022-02-16 16:07:24.627698"], ["id", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mPayroll Load (0.0ms)[0m  [1m[34mSELECT "payrolls".* FROM "payrolls" WHERE "payrolls"."id" = ? LIMIT ?[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mPayrollDetail Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "payroll_details" WHERE (payroll_id = 980190963)[0m
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[31mrollback transaction[0m
